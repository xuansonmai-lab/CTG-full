<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ph√¢n t√≠ch CTG - S·∫£n ph·ª• khoa</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 20px;
            overflow: hidden;
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-2px);
        }

        .card-header {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            padding: 20px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.3s ease;
        }

        .card-header:hover {
            background: linear-gradient(45deg, #45a049, #4CAF50);
        }

        .card-header h2 {
            font-size: 1.3rem;
            font-weight: 600;
        }

        .toggle-icon {
            font-size: 1.2rem;
            transition: transform 0.3s ease;
        }

        .toggle-icon.rotated {
            transform: rotate(180deg);
        }

        .card-content {
            padding: 25px;
            display: none;
        }

        .card-content.show {
            display: block;
        }

        .ctg-analysis {
            display: block !important;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        .form-group input, .form-group textarea, .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus, .form-group textarea:focus, .form-group select:focus {
            outline: none;
            border-color: #4CAF50;
            box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.1);
        }

        .apgar-input {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .apgar-input input {
            width: 80px;
            text-align: center;
        }

        .image-upload-area {
            border: 2px dashed #ccc;
            border-radius: 8px;
            padding: 30px;
            text-align: center;
            margin-bottom: 15px;
            transition: border-color 0.3s ease;
        }

        .image-upload-area:hover {
            border-color: #4CAF50;
        }

        .image-upload-area input[type="file"] {
            display: none;
        }

        .upload-btn {
            background: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            transition: background 0.3s ease;
        }

        .upload-btn:hover {
            background: #45a049;
        }

        .image-preview {
            margin-top: 15px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .image-preview img {
            max-width: 200px;
            max-height: 150px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .image-preview img:hover {
            transform: scale(1.05);
        }

        /* Modal cho ·∫£nh ph√≥ng to */
        .image-modal {
            display: none;
            position: fixed;
            z-index: 10000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.9);
            cursor: pointer;
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            max-width: 90%;
            max-height: 90%;
            border-radius: 8px;
        }

        .close-modal {
            position: absolute;
            top: 15px;
            right: 35px;
            color: #fff;
            font-size: 40px;
            font-weight: bold;
            cursor: pointer;
            z-index: 10001;
        }

        .close-modal:hover {
            opacity: 0.7;
        }

        .checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .checkbox-item input[type="checkbox"] {
            width: 20px;
            height: 20px;
        }

        .conditional-section {
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #4CAF50;
        }

        .summary-section {
            background: #e8f5e8;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }

        .summary-section h3 {
            color: #2e7d32;
            margin-bottom: 15px;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }

        .btn-primary {
            background: linear-gradient(45deg, #2196F3, #1976D2);
            color: white;
        }

        .btn-primary:hover {
            background: linear-gradient(45deg, #1976D2, #2196F3);
            transform: translateY(-2px);
        }

        .btn-success {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
        }

        .btn-success:hover {
            background: linear-gradient(45deg, #45a049, #4CAF50);
            transform: translateY(-2px);
        }

        .btn-warning {
            background: linear-gradient(45deg, #FF9800, #F57C00);
            color: white;
        }

        .btn-warning:hover {
            background: linear-gradient(45deg, #F57C00, #FF9800);
            transform: translateY(-2px);
        }

        .hidden {
            display: none !important;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìä Ph√¢n t√≠ch CTG</h1>
            <p>H·ªá th·ªëng ph√¢n t√≠ch Cardiotocography chuy√™n nghi·ªáp</p>
        </div>

        <!-- Ph·∫ßn I: Th√¥ng tin l√¢m s√†ng -->
        <div class="card">
            <div class="card-header" onclick="toggleSection('clinical-info')">
                <h2>Ph·∫ßn I: Th√¥ng tin l√¢m s√†ng v√† k·∫øt c·ª•c s∆° sinh</h2>
                <span class="toggle-icon">‚ñº</span>
            </div>
            <div class="card-content" id="clinical-info">
                <div class="form-group">
                    <label for="patient-id">ID b·ªánh nh√¢n:</label>
                    <input type="number" id="patient-id" placeholder="Nh·∫≠p ID b·ªánh nh√¢n">
                </div>

                <div class="form-group">
                    <label for="diagnosis">Ch·∫©n ƒëo√°n v√† ghi ch√∫:</label>
                    <textarea id="diagnosis" rows="4" placeholder="B√°c sƒ© t·ª± nh·∫≠p note..."></textarea>
                </div>

                <div class="form-group">
                    <label>K·∫øt c·ª•c s∆° sinh:</label>
                    
                    <div style="margin-bottom: 15px;">
                        <label for="apgar">APGAR:</label>
                        <div class="apgar-input">
                            <input type="number" id="apgar-1" min="0" max="10" placeholder="0">
                            <span>/</span>
                            <input type="number" id="apgar-2" min="0" max="10" placeholder="0">
                        </div>
                    </div>

                    <div>
                        <label for="ph-level">pH cu·ªëng r·ªën:</label>
                        <select id="ph-level">
                            <option value="">Ch·ªçn pH cu·ªëng r·ªën</option>
                            <option value="<7.0">< 7.0</option>
                            <option value="7.0-7.1">7.0 - 7.1</option>
                            <option value="7.1-7.2">7.1 - 7.2</option>
                            <option value=">7.2">> 7.2</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ph·∫ßn II: Ph√¢n t√≠ch CTG -->
        <div class="card">
            <div class="card-header">
                <h2>Ph·∫ßn II: Ph√¢n t√≠ch CTG</h2>
            </div>
            <div class="card-content ctg-analysis">
                <!-- T·∫£i ·∫£nh CTG -->
                <div class="form-group">
                    <label>T·∫£i l√™n ·∫£nh CTG:</label>
                    
                    <div class="image-upload-area">
                        <p>üì∑ ·∫¢nh CTG tr∆∞·ªõc ƒë√≥</p>
                        <input type="file" id="ctg-before" accept="image/*">
                        <div style="display: flex; gap: 10px; justify-content: center; margin-top: 10px;">
                            <button type="button" class="upload-btn" onclick="document.getElementById('ctg-before').click()">
                                üìÅ Ch·ªçn t·ª´ th∆∞ vi·ªán
                            </button>
                            <button type="button" class="upload-btn" onclick="captureImage('ctg-before')">
                                üì∏ Ch·ª•p ·∫£nh
                            </button>
                        </div>
                        <div id="preview-before" class="image-preview"></div>
                    </div>

                    <div class="image-upload-area">
                        <p>üì∑ ·∫¢nh CTG hi·ªán t·∫°i</p>
                        <input type="file" id="ctg-current" accept="image/*">
                        <div style="display: flex; gap: 10px; justify-content: center; margin-top: 10px;">
                            <button type="button" class="upload-btn" onclick="document.getElementById('ctg-current').click()">
                                üìÅ Ch·ªçn t·ª´ th∆∞ vi·ªán
                            </button>
                            <button type="button" class="upload-btn" onclick="captureImage('ctg-current')">
                                üì∏ Ch·ª•p ·∫£nh
                            </button>
                        </div>
                        <div id="preview-current" class="image-preview"></div>
                    </div>
                </div>

                <!-- G√≤ t·ª≠ cung -->
                <div class="form-group">
                    <label for="uterine-contractions">G√≤ t·ª≠ cung:</label>
                    <select id="uterine-contractions">
                        <option value="">Ch·ªçn t·∫ßn su·∫•t g√≤</option>
                        <option value="<5">< 5 c∆°n / 10 ph√∫t</option>
                        <option value=">5">> 5 c∆°n / 10 ph√∫t</option>
                        <option value=">2min">G√≤ > 2 ph√∫t</option>
                    </select>
                </div>

                <!-- Tim thai cƒÉn b·∫£n -->
                <div class="form-group">
                    <label for="fhr-baseline">Tim thai cƒÉn b·∫£n:</label>
                    <select id="fhr-baseline" onchange="handleFHRBaseline()">
                        <option value="">Ch·ªçn tim thai cƒÉn b·∫£n</option>
                        <option value="<80">< 80 bpm</option>
                        <option value="80-99">80-99 bpm</option>
                        <option value="100-109">100-109 bpm</option>
                        <option value="110-160">110-160 bpm</option>
                        <option value="160-179">160-179 bpm</option>
                        <option value=">180">> 180 bpm</option>
                        <option value="undefined">Kh√¥ng x√°c ƒë·ªãnh ƒë∆∞·ª£c baseline</option>
                    </select>
                    
                    <div id="fhr-110-160" class="conditional-section hidden">
                        <label>ƒê·∫∑c ƒëi·ªÉm tim thai 110-160 bpm:</label>
                        <select id="fhr-110-160-detail">
                            <option value="">Ch·ªçn ƒë·∫∑c ƒëi·ªÉm</option>
                            <option value="stable">·ªîn ƒë·ªãnh v√† ph√π h·ª£p tu·ªïi thai</option>
                            <option value="unstable">Kh√¥ng ·ªïn ƒë·ªãnh (l√∫c cao l√∫c th·∫•p)</option>
                            <option value="increase">TƒÉng ‚â• 20 bpm ho·∫∑c 10% so v·ªõi tr∆∞·ªõc ƒë√≥</option>
                            <option value="downward">C√≥ d·∫•u hi·ªáu ƒëi xu·ªëng d·∫ßn</option>
                        </select>
                    </div>

                    <div id="fhr-100-109" class="conditional-section hidden">
                        <label>Tim thai 100-109 bpm:</label>
                        <select id="fhr-100-109-detail">
                            <option value="">Ch·ªçn t√¨nh tr·∫°ng</option>
                            <option value="previous">Tr∆∞·ªõc ƒë√≥ c√≥ nh∆∞ v·∫≠y</option>
                            <option value="new">100-109 n√†y l√† m·ªõi xu·∫•t hi·ªán</option>
                        </select>
                    </div>
                </div>

                <!-- Dao ƒë·ªông n·ªôi t·∫°i -->
                <div class="form-group">
                    <label for="variability">Dao ƒë·ªông n·ªôi t·∫°i:</label>
                    <select id="variability" onchange="handleVariability()">
                        <option value="">Ch·ªçn dao ƒë·ªông n·ªôi t·∫°i</option>
                        <option value="absent">M·∫•t (<3)</option>
                        <option value="minimal">T·ªëi thi·ªÉu (3-5)</option>
                        <option value="normal">B√¨nh th∆∞·ªùng (6-25)</option>
                        <option value="increased">TƒÉng (>25)</option>
                        <option value="sinusoidal">H√¨nh d·∫°ng sin</option>
                    </select>

                    <div id="variability-absent-minimal" class="conditional-section hidden">
                        <label>Th·ªùi gian k√©o d√†i:</label>
                        <select id="variability-duration">
                            <option value="">Ch·ªçn th·ªùi gian</option>
                            <option value="30-40">30-40 ph√∫t</option>
                            <option value="40-50">40-50 ph√∫t</option>
                            <option value="50-90">50-90 ph√∫t</option>
                            <option value=">90">> 90 ph√∫t</option>
                        </select>
                    </div>

                    <div id="variability-increased" class="conditional-section hidden">
                        <label>Th·ªùi gian tƒÉng:</label>
                        <select id="variability-increased-duration">
                            <option value="">Ch·ªçn th·ªùi gian</option>
                            <option value="<10">< 10 ph√∫t</option>
                            <option value=">10">> 10 ph√∫t</option>
                        </select>
                    </div>
                </div>

                <!-- Nh·ªãp gi·∫£m -->
                <div class="form-group">
                    <label>Nh·ªãp gi·∫£m:</label>
                    <div class="checkbox-group" id="deceleration-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="no-decel" onchange="handleDeceleration('none')">
                            <label for="no-decel">Kh√¥ng c√≥ nh·ªãp gi·∫£m</label>
                        </div>
                        
                        <div class="checkbox-item">
                            <input type="checkbox" id="early-decel" onchange="handleDeceleration('early')">
                            <label for="early-decel">Nh·ªãp gi·∫£m s·ªõm</label>
                            <!-- Chi ti·∫øt nh·ªãp gi·∫£m s·ªõm -->
                            <div id="early-decel-details" class="conditional-section hidden" style="margin-left: 30px; margin-top: 10px;">
                                <label>ƒê·∫∑c ƒëi·ªÉm nh·ªãp gi·∫£m s·ªõm:</label>
                                <select id="early-decel-pattern">
                                    <option value="">Ch·ªçn ƒë·∫∑c ƒëi·ªÉm</option>
                                    <option value="isolated">ƒê∆°n l·∫ª - kh√¥ng l·∫∑p l·∫°i</option>
                                    <option value="repetitive">L·∫∑p l·∫°i</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="checkbox-item">
                            <input type="checkbox" id="variable-decel" onchange="handleDeceleration('variable')">
                            <label for="variable-decel">Nh·ªãp gi·∫£m b·∫•t ƒë·ªãnh</label>
                            <!-- Chi ti·∫øt nh·ªãp gi·∫£m b·∫•t ƒë·ªãnh -->
                            <div id="variable-decel-details" class="conditional-section hidden" style="margin-left: 30px; margin-top: 10px;">
                                <div style="margin-bottom: 15px;">
                                    <label>M·ª©c ƒë·ªô:</label>
                                    <select id="variable-severity">
                                        <option value="">Ch·ªçn m·ª©c ƒë·ªô</option>
                                        <option value="mild">Nh·∫π</option>
                                        <option value="severe-70">N·∫∑ng: Nadir < 70 nh·ªãp/ph√∫t v√† k√©o d√†i > 30 gi√¢y</option>
                                        <option value="severe-80">N·∫∑ng: Nadir 70-80 nh·ªãp/ph√∫t v√† k√©o d√†i > 60 gi√¢y</option>
                                    </select>
                                </div>

                                <div style="margin-bottom: 15px;">
                                    <label>ƒê·∫∑c ƒëi·ªÉm ƒë√°ng ng·∫°i (c√≥ th·ªÉ ch·ªçn nhi·ªÅu):</label>
                                    <div class="checkbox-group">
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="prolonged-60">
                                            <label for="prolonged-60">K√©o d√†i > 60 gi√¢y</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="decreased-variability">
                                            <label for="decreased-variability">Gi·∫£m dao ƒë·ªông n·ªôi t·∫°i trong nh·ªãp gi·∫£m</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="slow-return">
                                            <label for="slow-return">Tr·ªü v·ªÅ tim thai c∆° b·∫£n ch·∫≠m ho·∫∑c kh√¥ng tr·ªü v·ªÅ</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="lost-shouldering">
                                            <label for="lost-shouldering">M·∫•t d·∫°ng vai (shouldering)</label>
                                        </div>
                                    </div>
                                </div>

                                <div style="margin-bottom: 15px;">
                                    <label>T√≠nh ch·∫•t l·∫∑p l·∫°i:</label>
                                    <select id="variable-repetitive">
                                        <option value="">Ch·ªçn t√≠nh ch·∫•t</option>
                                        <option value="non-repetitive">Kh√¥ng l·∫∑p l·∫°i</option>
                                        <option value="repetitive">L·∫∑p l·∫°i</option>
                                    </select>
                                </div>

                                <div>
                                    <label>Th·ªùi gian xu·∫•t hi·ªán:</label>
                                    <select id="variable-duration">
                                        <option value="">Ch·ªçn th·ªùi gian</option>
                                        <option value=">30">> 30 ph√∫t</option>
                                        <option value="<30">< 30 ph√∫t</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="checkbox-item">
                            <input type="checkbox" id="late-decel" onchange="handleDeceleration('late')">
                            <label for="late-decel">Nh·ªãp gi·∫£m mu·ªôn</label>
                            <!-- Chi ti·∫øt nh·ªãp gi·∫£m mu·ªôn -->
                            <div id="late-decel-details" class="conditional-section hidden" style="margin-left: 30px; margin-top: 10px;">
                                <div style="margin-bottom: 15px;">
                                    <label>M·ª©c ƒë·ªô:</label>
                                    <select id="late-severity">
                                        <option value="">Ch·ªçn m·ª©c ƒë·ªô</option>
                                        <option value="mild">Nh·∫π</option>
                                        <option value="severe">N·∫∑ng: Nadir th·∫•p h∆°n 15 bpm so v·ªõi tim thai cƒÉn b·∫£n</option>
                                    </select>
                                </div>

                                <div style="margin-bottom: 15px;">
                                    <label>T√≠nh ch·∫•t l·∫∑p l·∫°i:</label>
                                    <select id="late-repetitive">
                                        <option value="">Ch·ªçn t√≠nh ch·∫•t</option>
                                        <option value="non-repetitive">Kh√¥ng l·∫∑p l·∫°i</option>
                                        <option value="repetitive">L·∫∑p l·∫°i</option>
                                    </select>
                                </div>

                                <div>
                                    <label>Xu·∫•t hi·ªán:</label>
                                    <select id="late-duration">
                                        <option value="">Ch·ªçn th·ªùi gian</option>
                                        <option value=">30">> 30 ph√∫t</option>
                                        <option value="<30">< 30 ph√∫t</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="checkbox-item">
                            <input type="checkbox" id="prolonged-decel" onchange="handleDeceleration('prolonged')">
                            <label for="prolonged-decel">Nh·ªãp gi·∫£m k√©o d√†i</label>
                            <!-- Chi ti·∫øt nh·ªãp gi·∫£m k√©o d√†i -->
                            <div id="prolonged-decel-details" class="conditional-section hidden" style="margin-left: 30px; margin-top: 10px;">
                                <div style="margin-bottom: 15px;">
                                    <label>M·ª©c ƒë·ªô:</label>
                                    <select id="prolonged-severity">
                                        <option value="">Ch·ªçn m·ª©c ƒë·ªô</option>
                                        <option value="mild">Nh·∫π</option>
                                        <option value="severe">N·∫∑ng: Nadir < 80 bpm</option>
                                    </select>
                                </div>

                                <div style="margin-bottom: 15px;">
                                    <label>Xu·∫•t hi·ªán:</label>
                                    <select id="prolonged-onset">
                                        <option value="">Ch·ªçn th·ªùi gian xu·∫•t hi·ªán</option>
                                        <option value="<20">< 20 ph√∫t</option>
                                        <option value="20-30">20-30 ph√∫t</option>
                                        <option value=">30">> 30 ph√∫t</option>
                                    </select>
                                </div>

                                <div style="margin-bottom: 15px;">
                                    <label>ƒê·ªô d√†i:</label>
                                    <select id="prolonged-length">
                                        <option value="">Ch·ªçn ƒë·ªô d√†i</option>
                                        <option value="2-3">2-3 ph√∫t</option>
                                        <option value=">3">> 3 ph√∫t</option>
                                    </select>
                                </div>

                                <div>
                                    <label>C√≥ tim thai ch·∫≠m c·∫•p t√≠nh kh√¥ng?</label>
                                    <select id="acute-bradycardia">
                                        <option value="">Ch·ªçn</option>
                                        <option value="yes">C√≥</option>
                                        <option value="no">Kh√¥ng</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="decel-time-question" class="conditional-section hidden">
                        <label>C√¢u h·ªèi b·ªï sung v·ªÅ nh·ªãp gi·∫£m:</label>
                        
                        <div class="checkbox-group" style="margin-top: 10px;">
                            <div class="checkbox-item">
                                <input type="checkbox" id="baseline-rise-after-decel">
                                <label for="baseline-rise-after-decel">C√≥ hi·ªán t∆∞·ª£ng tim thai cƒÉn b·∫£n tƒÉng sau khi xu·∫•t hi·ªán nh·ªãp gi·∫£m</label>
                            </div>
                            
                            <div class="checkbox-item">
                                <input type="checkbox" id="time-in-decel-more">
                                <label for="time-in-decel-more">Th·ªùi gian thai trong nh·ªãp gi·∫£m > th·ªùi gian trong tim thai cƒÉn b·∫£n</label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Nh·ªãp tƒÉng -->
                <div class="form-group">
                    <label for="accelerations">Nh·ªãp tƒÉng:</label>
                    <select id="accelerations" onchange="handleAccelerations()">
                        <option value="">Ch·ªçn nh·ªãp tƒÉng</option>
                        <option value="yes">C√≥</option>
                        <option value="no">Kh√¥ng</option>
                    </select>

                    <div id="no-accelerations-details" class="conditional-section hidden">
                        <div style="margin-bottom: 15px;">
                            <label>C√≤n chu k·ª≥ t·ªânh - ng·ªß kh√¥ng?</label>
                            <select id="sleep-wake-cycle">
                                <option value="">Ch·ªçn</option>
                                <option value="yes">C√≥</option>
                                <option value="no">Kh√¥ng</option>
                            </select>
                        </div>

                        <div>
                            <label>C√≥ m·∫•t nh·ªãp tƒÉng sau nh·ªØng nh·ªãp gi·∫£m kh√¥ng?</label>
                            <select id="lost-accelerations">
                                <option value="">Ch·ªçn</option>
                                <option value="yes">C√≥ (d·∫•u hi·ªáu thi·∫øu oxy di·ªÖn ti·∫øn)</option>
                                <option value="no">Kh√¥ng</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- T·ªïng qu√°t -->
                <div class="summary-section">
                    <h3>üìã T·ªïng qu√°t</h3>
                    
                    <div class="form-group">
                        <label for="clinical-diagnosis">Ch·∫©n ƒëo√°n l√¢m s√†ng:</label>
                        <textarea id="clinical-diagnosis" rows="3" readonly></textarea>
                    </div>

                    <div class="form-group">
                        <label for="ctg-description">M√¥ t·∫£ CTG:</label>
                        <textarea id="ctg-description" rows="4" readonly></textarea>
                    </div>
                </div>

                <!-- K·∫øt qu·∫£ ph√¢n t√≠ch (·∫©n ban ƒë·∫ßu) -->
                <div id="analysis-results" class="hidden">
                    <!-- Ph√¢n lo·∫°i ACOG 2009 -->
                    <div class="summary-section" style="background: #e3f2fd;">
                        <h3>üî¨ Ph√¢n lo·∫°i ACOG 2009</h3>
                        
                        <div class="form-group">
                            <label for="acog-classification">Nh√≥m ph√¢n lo·∫°i:</label>
                            <input type="text" id="acog-classification" readonly style="font-weight: bold; font-size: 1.1rem;">
                        </div>

                        <div class="form-group">
                            <label for="acog-details">Chi ti·∫øt ph√¢n lo·∫°i:</label>
                            <textarea id="acog-details" rows="5" readonly></textarea>
                        </div>
                    </div>

                    <!-- Ph√¢n lo·∫°i FIGO 2015 -->
                    <div class="summary-section" style="background: #f0f8e8;">
                        <h3>üåç Ph√¢n lo·∫°i FIGO 2015</h3>
                        
                        <div class="form-group">
                            <label for="figo-classification">Ph√¢n lo·∫°i:</label>
                            <input type="text" id="figo-classification" readonly style="font-weight: bold; font-size: 1.1rem;">
                        </div>

                        <div class="form-group">
                            <label for="figo-details">Chi ti·∫øt ƒë√°nh gi√°:</label>
                            <textarea id="figo-details" rows="5" readonly></textarea>
                        </div>

                        <div class="form-group">
                            <label for="figo-management">X·ª≠ tr√≠ l√¢m s√†ng:</label>
                            <textarea id="figo-management" rows="3" readonly></textarea>
                        </div>
                    </div>

                    <!-- Ph√¢n lo·∫°i NICE 2022 -->
                    <div class="summary-section" style="background: #f3e5f5;">
                        <h3>üá¨üáß Ph√¢n lo·∫°i NICE 2022</h3>
                        
                        <div class="form-group">
                            <label for="nice-classification">K·∫øt qu·∫£ ph√¢n lo·∫°i:</label>
                            <input type="text" id="nice-classification" readonly style="font-weight: bold; font-size: 1.1rem;">
                        </div>

                        <div class="form-group">
                            <label for="nice-details">Chi ti·∫øt t·ª´ng ti√™u ch√≠:</label>
                            <textarea id="nice-details" rows="6" readonly></textarea>
                        </div>

                        <div class="form-group">
                            <label for="nice-management">Khuy·∫øn ngh·ªã x·ª≠ tr√≠:</label>
                            <textarea id="nice-management" rows="3" readonly></textarea>
                        </div>
                    </div>

                    <!-- Ph√¢n lo·∫°i Hi·ªáp h·ªôi S·∫£n ph·ª• khoa Nh·∫≠t B·∫£n -->
                    <div class="summary-section" style="background: #ffe8e8;">
                        <h3>üáØüáµ Ph√¢n lo·∫°i Hi·ªáp h·ªôi S·∫£n ph·ª• khoa Nh·∫≠t B·∫£n (5 m·ª©c)</h3>
                        
                        <div class="form-group">
                            <label for="japan-classification">M·ª©c ph√¢n lo·∫°i:</label>
                            <input type="text" id="japan-classification" readonly style="font-weight: bold; font-size: 1.1rem;">
                        </div>

                        <div class="form-group">
                            <label for="japan-details">Chi ti·∫øt ph√¢n lo·∫°i:</label>
                            <textarea id="japan-details" rows="6" readonly></textarea>
                        </div>

                        <div class="form-group">
                            <label for="japan-interpretation">√ù nghƒ©a l√¢m s√†ng:</label>
                            <textarea id="japan-interpretation" rows="3" readonly></textarea>
                        </div>
                    </div>

                    <!-- Ph√¢n lo·∫°i theo Sinh l√Ω (Physiological) -->
                    <div class="summary-section" style="background: #e8f4fd;">
                        <h3>üß¨ Ph√¢n lo·∫°i theo Sinh l√Ω (Physiological Interpretation)</h3>
                        
                        <div class="form-group">
                            <label for="physio-classification">Ph√¢n lo·∫°i:</label>
                            <input type="text" id="physio-classification" readonly style="font-weight: bold; font-size: 1.1rem;">
                        </div>

                        <div class="form-group">
                            <label for="physio-details">ƒê·∫∑c ƒëi·ªÉm sinh l√Ω:</label>
                            <textarea id="physio-details" rows="6" readonly></textarea>
                        </div>

                        <div class="form-group">
                            <label for="physio-management">Khuy·∫øn ngh·ªã x·ª≠ tr√≠:</label>
                            <textarea id="physio-management" rows="4" readonly></textarea>
                        </div>
                    </div>
                </div>

                <!-- N√∫t h√†nh ƒë·ªông -->
                <div class="action-buttons">
                    <button class="btn btn-primary" onclick="saveAndAnalyzeCTG()">
                        üíæ L∆∞u v√† ph√¢n t√≠ch CTG
                    </button>
                    <button class="btn btn-success" onclick="exportPDF()">
                        üìÑ Xu·∫•t file PDF
                    </button>
                    <button class="btn btn-warning" onclick="reassess()">
                        üîÑ ƒê√°nh gi√° l·∫°i
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal cho ph√≥ng to ·∫£nh -->
    <div id="imageModal" class="image-modal" onclick="closeImageModal()">
        <span class="close-modal" onclick="closeImageModal()">&times;</span>
        <img class="modal-content" id="modalImage">
    </div>

    <!-- Th∆∞ vi·ªán jsPDF cho xu·∫•t PDF v·ªõi font ti·∫øng Vi·ªát -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <script>
        // Kh·ªüi t·∫°o
        document.addEventListener('DOMContentLoaded', function() {
            setupImageUpload();
            updateSummary();
        });

        // Toggle section
        function toggleSection(sectionId) {
            const content = document.getElementById(sectionId);
            const header = content.previousElementSibling;
            const icon = header.querySelector('.toggle-icon');
            
            if (content.classList.contains('show')) {
                content.classList.remove('show');
                icon.classList.remove('rotated');
            } else {
                content.classList.add('show');
                icon.classList.add('rotated');
            }
        }

        // X·ª≠ l√Ω upload ·∫£nh
        function setupImageUpload() {
            ['ctg-before', 'ctg-current'].forEach(id => {
                document.getElementById(id).addEventListener('change', function(e) {
                    handleImageUpload(e, id);
                });
            });
        }

        function handleImageUpload(event, inputId) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const previewId = inputId === 'ctg-before' ? 'preview-before' : 'preview-current';
                    const preview = document.getElementById(previewId);
                    const img = document.createElement('img');
                    img.src = e.target.result;
                    img.alt = 'CTG Preview';
                    img.onclick = function() { openImageModal(e.target.result); };
                    preview.innerHTML = '';
                    preview.appendChild(img);
                };
                reader.readAsDataURL(file);
            }
        }

        // H√†m ph√≥ng to ·∫£nh
        function openImageModal(src) {
            document.getElementById('modalImage').src = src;
            document.getElementById('imageModal').style.display = 'block';
        }

        function closeImageModal() {
            document.getElementById('imageModal').style.display = 'none';
        }

        // H√†m ch·ª•p ·∫£nh
        function captureImage(inputId) {
            const input = document.getElementById(inputId);
            input.setAttribute('capture', 'camera');
            input.click();
        }

        // X·ª≠ l√Ω tim thai cƒÉn b·∫£n
        function handleFHRBaseline() {
            const value = document.getElementById('fhr-baseline').value;
            
            // ·∫®n t·∫•t c·∫£ c√°c section
            document.getElementById('fhr-110-160').classList.add('hidden');
            document.getElementById('fhr-100-109').classList.add('hidden');
            
            // Hi·ªÉn th·ªã section t∆∞∆°ng ·ª©ng
            if (value === '110-160') {
                document.getElementById('fhr-110-160').classList.remove('hidden');
            } else if (value === '100-109') {
                document.getElementById('fhr-100-109').classList.remove('hidden');
            }
            
            updateSummary();
        }

        // X·ª≠ l√Ω dao ƒë·ªông n·ªôi t·∫°i
        function handleVariability() {
            const value = document.getElementById('variability').value;
            
            // ·∫®n t·∫•t c·∫£ c√°c section
            document.getElementById('variability-absent-minimal').classList.add('hidden');
            document.getElementById('variability-increased').classList.add('hidden');
            
            // Hi·ªÉn th·ªã section t∆∞∆°ng ·ª©ng
            if (value === 'absent' || value === 'minimal') {
                document.getElementById('variability-absent-minimal').classList.remove('hidden');
            } else if (value === 'increased') {
                document.getElementById('variability-increased').classList.remove('hidden');
            }
            
            updateSummary();
        }

        // X·ª≠ l√Ω nh·ªãp gi·∫£m
        function handleDeceleration(type) {
            const checkboxes = document.querySelectorAll('#deceleration-group input[type="checkbox"]');
            
            if (type === 'none') {
                const noDecel = document.getElementById('no-decel');
                if (noDecel.checked) {
                    // B·ªè ch·ªçn t·∫•t c·∫£ c√°c checkbox kh√°c
                    checkboxes.forEach(cb => {
                        if (cb.id !== 'no-decel') cb.checked = false;
                    });
                    // ·∫®n t·∫•t c·∫£ c√°c section chi ti·∫øt
                    hideAllDecelDetails();
                }
            } else {
                // N·∫øu ch·ªçn b·∫•t k·ª≥ lo·∫°i nh·ªãp gi·∫£m n√†o kh√°c, b·ªè ch·ªçn "kh√¥ng c√≥ nh·ªãp gi·∫£m"
                document.getElementById('no-decel').checked = false;
                showDecelDetails(type);
            }
            
            updateDecelTimeQuestion();
            updateSummary();
        }

        function hideAllDecelDetails() {
            ['early-decel-details', 'variable-decel-details', 'late-decel-details', 
             'prolonged-decel-details', 'decel-time-question'].forEach(id => {
                document.getElementById(id).classList.add('hidden');
            });
        }

        function showDecelDetails(type) {
            const detailsMap = {
                'early': 'early-decel-details',
                'variable': 'variable-decel-details',
                'late': 'late-decel-details',
                'prolonged': 'prolonged-decel-details'
            };
            
            if (detailsMap[type]) {
                document.getElementById(detailsMap[type]).classList.remove('hidden');
            }
        }

        function updateDecelTimeQuestion() {
            const hasDecel = ['early-decel', 'variable-decel', 'late-decel', 'prolonged-decel']
                .some(id => document.getElementById(id).checked);
            const noDecel = document.getElementById('no-decel').checked;
            
            if (hasDecel && !noDecel) {
                document.getElementById('decel-time-question').classList.remove('hidden');
            } else {
                document.getElementById('decel-time-question').classList.add('hidden');
            }
        }

        // X·ª≠ l√Ω nh·ªãp tƒÉng
        function handleAccelerations() {
            const value = document.getElementById('accelerations').value;
            
            if (value === 'no') {
                document.getElementById('no-accelerations-details').classList.remove('hidden');
            } else {
                document.getElementById('no-accelerations-details').classList.add('hidden');
            }
            
            updateSummary();
        }

        // C·∫≠p nh·∫≠t t·ªïng qu√°t
        function updateSummary() {
            const diagnosis = generateClinicalDiagnosis();
            const ctgDescription = generateCTGDescription();
            
            document.getElementById('clinical-diagnosis').value = diagnosis;
            document.getElementById('ctg-description').value = ctgDescription;
        }

        function generateClinicalDiagnosis() {
            let diagnosis = [];
            
            // Th√¥ng tin c∆° b·∫£n
            const patientId = document.getElementById('patient-id').value;
            if (patientId) {
                diagnosis.push(`B·ªánh nh√¢n ID: ${patientId}`);
            }
            
            const diagnosisNote = document.getElementById('diagnosis').value;
            if (diagnosisNote) {
                diagnosis.push(diagnosisNote);
            }
            
            return diagnosis.join(', ');
        }

        // C·∫≠p nh·∫≠t m√¥ t·∫£ CTG ƒë·ªÉ hi·ªÉn th·ªã multiple decelerations
        function generateCTGDescription() {
            let description = [];
            
            // G√≤ t·ª≠ cung
            const contractions = document.getElementById('uterine-contractions').value;
            if (contractions === '>5') {
                description.push('g√≤ c∆∞·ªùng t√≠nh');
            } else if (contractions) {
                description.push(`g√≤ t·ª≠ cung ${contractions}`);
            }
            
            // Tim thai
            const fhr = document.getElementById('fhr-baseline').value;
            if (fhr === '<80' || fhr === '80-99' || fhr === '100-109') {
                description.push('tim thai ch·∫≠m');
            } else if (fhr === '160-179' || fhr === '>180') {
                description.push('tim thai nhanh');
            } else if (fhr === '110-160') {
                const detail = document.getElementById('fhr-110-160-detail').value;
                if (detail === 'stable') {
                    description.push('tim thai ·ªïn ƒë·ªãnh');
                } else if (detail === 'unstable') {
                    description.push('tim thai kh√¥ng ·ªïn ƒë·ªãnh');
                }
            }
            
            // Dao ƒë·ªông n·ªôi t·∫°i
            const variability = document.getElementById('variability').value;
            const variabilityMap = {
                'absent': 'm·∫•t dao ƒë·ªông n·ªôi t·∫°i',
                'minimal': 'dao ƒë·ªông n·ªôi t·∫°i t·ªëi thi·ªÉu',
                'normal': 'dao ƒë·ªông n·ªôi t·∫°i b√¨nh th∆∞·ªùng',
                'increased': 'dao ƒë·ªông n·ªôi t·∫°i tƒÉng',
                'sinusoidal': 'dao ƒë·ªông h√¨nh sin'
            };
            if (variabilityMap[variability]) {
                description.push(variabilityMap[variability]);
            }
            
            // Nh·ªãp gi·∫£m - m√¥ t·∫£ t·∫•t c·∫£ lo·∫°i ƒë∆∞·ª£c ch·ªçn
            const decelTypes = [];
            
            if (document.getElementById('no-decel').checked) {
                decelTypes.push('kh√¥ng c√≥ nh·ªãp gi·∫£m');
            } else {
                if (document.getElementById('early-decel').checked) {
                    decelTypes.push('nh·ªãp gi·∫£m s·ªõm');
                }
                
                if (document.getElementById('variable-decel').checked) {
                    let varDecel = 'nh·ªãp gi·∫£m b·∫•t ƒë·ªãnh';
                    const severity = document.getElementById('variable-severity').value;
                    if (severity && severity.includes('severe')) {
                        varDecel += ' n·∫∑ng';
                    }
                    
                    // Ki·ªÉm tra ƒë·∫∑c ƒëi·ªÉm ƒë√°ng ng·∫°i
                    const concerningFeatures = [];
                    if (document.getElementById('prolonged-60').checked) concerningFeatures.push('k√©o d√†i');
                    if (document.getElementById('decreased-variability').checked) concerningFeatures.push('gi·∫£m dao ƒë·ªông');
                    if (document.getElementById('slow-return').checked) concerningFeatures.push('tr·ªü v·ªÅ ch·∫≠m');
                    if (document.getElementById('lost-shouldering').checked) concerningFeatures.push('m·∫•t vai');
                    
                    if (concerningFeatures.length > 0) {
                        varDecel += ' c√≥ ƒë·∫∑c ƒëi·ªÉm ƒë√°ng ng·∫°i';
                    }
                    
                    const repetitive = document.getElementById('variable-repetitive').value;
                    if (repetitive === 'repetitive') {
                        varDecel += ' l·∫∑p l·∫°i';
                    }
                    
                    const duration = document.getElementById('variable-duration').value;
                    if (duration === '>30') {
                        varDecel += ' > 30 ph√∫t';
                    }
                    
                    decelTypes.push(varDecel);
                }
                
                if (document.getElementById('late-decel').checked) {
                    let lateDecel = 'nh·ªãp gi·∫£m mu·ªôn';
                    const severity = document.getElementById('late-severity').value;
                    if (severity === 'severe') {
                        lateDecel += ' n·∫∑ng';
                    } else if (severity === 'mild') {
                        lateDecel += ' nh·∫π';
                    }
                    
                    const repetitive = document.getElementById('late-repetitive').value;
                    if (repetitive === 'repetitive') {
                        lateDecel += ' l·∫∑p l·∫°i';
                    }
                    
                    decelTypes.push(lateDecel);
                }
                
                if (document.getElementById('prolonged-decel').checked) {
                    let prolongedDecel = 'nh·ªãp gi·∫£m k√©o d√†i';
                    const severity = document.getElementById('prolonged-severity').value;
                    if (severity === 'severe') {
                        prolongedDecel += ' n·∫∑ng';
                    }
                    
                    decelTypes.push(prolongedDecel);
                }
            }
            
            if (decelTypes.length > 0) {
                description.push(decelTypes.join(', '));
            }
            
            // Nh·ªãp tƒÉng
            const accelerations = document.getElementById('accelerations').value;
            if (accelerations === 'no') {
                description.push('kh√¥ng c√≥ nh·ªãp tƒÉng');
            }
            
            return description.join(', ');
        }

        // T√≠nh to√°n ph√¢n lo·∫°i ACOG 2009
        function calculateACOGClassification() {
            const baseline = document.getElementById('fhr-baseline').value;
            const variability = document.getElementById('variability').value;
            const noDecel = document.getElementById('no-decel').checked;
            const earlyDecel = document.getElementById('early-decel').checked;
            const variableDecel = document.getElementById('variable-decel').checked;
            const lateDecel = document.getElementById('late-decel').checked;
            const prolongedDecel = document.getElementById('prolonged-decel').checked;
            
            // Ki·ªÉm tra Nh√≥m III tr∆∞·ªõc
            // Tr∆∞·ªùng h·ª£p 1: Kh√¥ng c√≥ dao ƒë·ªông n·ªôi t·∫°i (<3) + c√°c y·∫øu t·ªë kh√°c
            if (variability === 'absent') {
                let groupIIIReasons = ['Kh√¥ng c√≥ dao ƒë·ªông n·ªôi t·∫°i (<3)'];
                
                // Nh·ªãp gi·∫£m mu·ªôn n·∫∑ng l·∫∑p l·∫°i
                if (lateDecel) {
                    const lateSeverity = document.getElementById('late-severity').value;
                    const lateRepetitive = document.getElementById('late-repetitive').value;
                    if (lateSeverity === 'severe' && lateRepetitive === 'repetitive') {
                        groupIIIReasons.push('nh·ªãp gi·∫£m mu·ªôn n·∫∑ng l·∫∑p l·∫°i');
                    }
                }
                
                // Nh·ªãp gi·∫£m b·∫•t ƒë·ªãnh l·∫∑p l·∫°i
                if (variableDecel) {
                    const varRepetitive = document.getElementById('variable-repetitive').value;
                    if (varRepetitive === 'repetitive') {
                        groupIIIReasons.push('nh·ªãp gi·∫£m b·∫•t ƒë·ªãnh l·∫∑p l·∫°i');
                    }
                }
                
                // Tim thai cƒÉn b·∫£n ch·∫≠m
                if (baseline === '<80' || baseline === '80-99' || baseline === '100-109') {
                    groupIIIReasons.push('tim thai cƒÉn b·∫£n ch·∫≠m (d∆∞·ªõi 110 bpm)');
                }
                
                if (groupIIIReasons.length > 1) {
                    return {
                        group: 'Nh√≥m III',
                        details: 'Ph√¢n lo·∫°i: Nh√≥m III\n\nTi√™u chu·∫©n: ' + groupIIIReasons.join(' k√®m theo ') + '\n\nƒê√¢y l√† CTG b·∫•t th∆∞·ªùng c√≥ nguy c∆° cao, c·∫ßn can thi·ªáp ngay l·∫≠p t·ª©c.'
                    };
                }
            }
            
            // Tr∆∞·ªùng h·ª£p 2: Bi·ªÉu ƒë·ªì d·∫°ng h√¨nh sin
            if (variability === 'sinusoidal') {
                return {
                    group: 'Nh√≥m III',
                    details: 'Ph√¢n lo·∫°i: Nh√≥m III\n\nTi√™u chu·∫©n: Bi·ªÉu ƒë·ªì d·∫°ng h√¨nh sin\n\nƒê√¢y l√† CTG b·∫•t th∆∞·ªùng c√≥ nguy c∆° cao, c·∫ßn can thi·ªáp ngay l·∫≠p t·ª©c.'
                };
            }
            
            // Ki·ªÉm tra Nh√≥m I
            let groupICriteria = [];
            let groupIFailed = [];
            
            // 1. Baseline 110-160
            if (baseline === '110-160') {
                groupICriteria.push('Tim thai cƒÉn b·∫£n 110-160 nh·ªãp/ph√∫t');
            } else {
                groupIFailed.push('Tim thai cƒÉn b·∫£n kh√¥ng trong kho·∫£ng 110-160');
            }
            
            // 2. Dao ƒë·ªông n·ªôi t·∫°i 5-25 (b√¨nh th∆∞·ªùng)
            if (variability === 'normal') {
                groupICriteria.push('Dao ƒë·ªông n·ªôi t·∫°i b√¨nh th∆∞·ªùng (6-25)');
            } else {
                groupIFailed.push('Dao ƒë·ªông n·ªôi t·∫°i kh√¥ng b√¨nh th∆∞·ªùng');
            }
            
            // 3. Kh√¥ng c√≥ nh·ªãp gi·∫£m mu·ªôn n·∫∑ng
            let hasLateSevere = false;
            if (lateDecel) {
                const lateSeverity = document.getElementById('late-severity').value;
                if (lateSeverity === 'severe') {
                    hasLateSevere = true;
                    groupIFailed.push('C√≥ nh·ªãp gi·∫£m mu·ªôn n·∫∑ng');
                }
            }
            if (!hasLateSevere) {
                groupICriteria.push('Kh√¥ng c√≥ nh·ªãp gi·∫£m mu·ªôn n·∫∑ng');
            }
            
            // 4. Kh√¥ng c√≥ nh·ªãp gi·∫£m b·∫•t ƒë·ªãnh
            if (!variableDecel) {
                groupICriteria.push('Kh√¥ng c√≥ nh·ªãp gi·∫£m b·∫•t ƒë·ªãnh');
            } else {
                groupIFailed.push('C√≥ nh·ªãp gi·∫£m b·∫•t ƒë·ªãnh');
            }
            
            // 5. Nh·ªãp gi·∫£m s·ªõm c√≥ ho·∫∑c kh√¥ng
            if (earlyDecel || noDecel) {
                groupICriteria.push('Nh·ªãp gi·∫£m s·ªõm c√≥ ho·∫∑c kh√¥ng c√≥');
            }
            
            // 6. Nh·ªãp tƒÉng c√≥ ho·∫∑c kh√¥ng
            groupICriteria.push('Nh·ªãp tƒÉng c√≥ ho·∫∑c kh√¥ng c√≥');
            
            // N·∫øu th·ªèa m√£n t·∫•t c·∫£ ti√™u chu·∫©n Nh√≥m I
            if (groupIFailed.length === 0 && baseline === '110-160' && variability === 'normal' && !hasLateSevere && !variableDecel) {
                return {
                    group: 'Nh√≥m I',
                    details: 'Ph√¢n lo·∫°i: Nh√≥m I (B√¨nh th∆∞·ªùng)\n\nTi√™u chu·∫©n th·ªèa m√£n:\n‚Ä¢ ' + groupICriteria.join('\n‚Ä¢ ') + '\n\nCTG b√¨nh th∆∞·ªùng, ti·∫øp t·ª•c theo d√µi th∆∞·ªùng quy.'
                };
            }
            
            // N·∫øu kh√¥ng ph·∫£i Nh√≥m I ho·∫∑c III th√¨ l√† Nh√≥m II
            let groupIIReasons = [];
            if (groupIFailed.length > 0) {
                groupIIReasons = groupIFailed;
            } else {
                groupIIReasons.push('Kh√¥ng ƒë·ªß ti√™u chu·∫©n ƒë·ªÉ ph√¢n v√†o Nh√≥m I ho·∫∑c Nh√≥m III');
            }
            
            return {
                group: 'Nh√≥m II',
                details: 'Ph√¢n lo·∫°i: Nh√≥m II (Kh√¥ng x√°c ƒë·ªãnh)\n\nL√Ω do:\n‚Ä¢ ' + groupIIReasons.join('\n‚Ä¢ ') + '\n\nC·∫ßn ti·∫øp t·ª•c theo d√µi ch·∫∑t ch·∫Ω v√† ƒë√°nh gi√° l·∫°i trong th·ªùi gian ng·∫Øn.'
            };
        }

        // T√≠nh to√°n ph√¢n lo·∫°i NICE 2022
        function calculateNICEClassification() {
            // 1. Ki·ªÉm tra c√°c tr∆∞·ªùng b·∫Øt bu·ªôc
            const baseline = document.getElementById('fhr-baseline').value;
            if (baseline === '100-109') {
                const detail = document.getElementById('fhr-100-109-detail').value;
                if (!detail) {
                    return {
                        classification: 'Thi·∫øu th√¥ng tin',
                        details: 'C·∫ßn ch·ªçn chi ti·∫øt cho tim thai 100-109 bpm (ƒë√£ c√≥ t·ª´ tr∆∞·ªõc hay m·ªõi xu·∫•t hi·ªán)',
                        management: 'Vui l√≤ng ho√†n thi·ªán th√¥ng tin ƒë·ªÉ c√≥ k·∫øt qu·∫£ ph√¢n t√≠ch ch√≠nh x√°c.'
                    };
                }
            }

            // Ph√¢n t√≠ch t·ª´ng ti√™u ch√≠
            const contractions = analyzeContractions();
            const fhrBaseline = analyzeFHRBaseline();
            const variability = analyzeVariability();
            const decelerations = analyzeDecelerations();

            // ƒê·∫øm s·ªë ti√™u ch√≠ ·ªü m·ªói m·ª©c
            let normalCount = 0;
            let suspiciousCount = 0;
            let abnormalCount = 0;
            let unclassifiedCount = 0;

            const criteria = [contractions, fhrBaseline, variability, decelerations];
            
            criteria.forEach(criterion => {
                if (criterion.category === 'normal') normalCount++;
                else if (criterion.category === 'suspicious') suspiciousCount++;
                else if (criterion.category === 'abnormal') abnormalCount++;
                else if (criterion.category === 'unclassified') unclassifiedCount++;
            });

            // X√°c ƒë·ªãnh ph√¢n lo·∫°i t·ªïng th·ªÉ
            let finalClassification;
            let color;
            let management;

            if (unclassifiedCount > 0) {
                finalClassification = 'Unclassified';
                color = '#9e9e9e';
                management = 'Kh√¥ng th·ªÉ ph√¢n lo·∫°i theo NICE 2022 do c√≥ y·∫øu t·ªë kh√¥ng ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a trong h∆∞·ªõng d·∫´n.';
            } else if (abnormalCount >= 1 || suspiciousCount >= 2) {
                finalClassification = 'B·∫§T TH∆Ø·ªúNG (ƒê·ªè)';
                color = '#f44336';
                management = 'ƒê√°nh gi√° to√†n di·ªán bao g·ªìm m·∫π; h·ªìi sinh, h·ªìi s·ª©c; c√¢n nh·∫Øc k√≠ch th√≠ch ƒë·∫ßu thai, lo·∫°i tr·ª´ tai bi·∫øn c·∫•p v√† c√¢n nh·∫Øc CDTK ngay.';
            } else if (suspiciousCount === 1) {
                finalClassification = 'NGHI NG·ªú (V√†ng)';
                color = '#ff9800';
                management = 'ƒê√°nh gi√° to√†n di·ªán, bao g·ªìm c·∫£ m·∫π; h·ªèi cƒÉn nguy√™n, h·ªìi s·ª©c; c√¢n nh·∫Øc k√≠ch th√≠ch ƒë·∫ßu thai ho·∫∑c th·ª•c ƒë·∫©y/chuy·ªÉn d·∫°/CTDK.';
            } else if (normalCount === 4) {
                finalClassification = 'B√åNH TH∆Ø·ªúNG (Tr·∫Øng)';
                color = '#4caf50';
                management = 'Ti·∫øp t·ª•c theo d√µi th∆∞·ªùng quy.';
            } else {
                finalClassification = 'Kh√¥ng x√°c ƒë·ªãnh';
                color = '#9e9e9e';
                management = 'C·∫ßn ƒë√°nh gi√° l·∫°i c√°c ti√™u ch√≠.';
            }

            // T·∫°o chi ti·∫øt
            const details = [
                `1. G√≤ t·ª≠ cung: ${contractions.description} ‚Üí ${contractions.category.toUpperCase()}`,
                `2. Tim thai cƒÉn b·∫£n: ${fhrBaseline.description} ‚Üí ${fhrBaseline.category.toUpperCase()}`,
                `3. Dao ƒë·ªông n·ªôi t·∫°i: ${variability.description} ‚Üí ${variability.category.toUpperCase()}`,
                `4. Nh·ªãp gi·∫£m: ${decelerations.description} ‚Üí ${decelerations.category.toUpperCase()}`,
                '',
                `T·ªïng k·∫øt: ${normalCount} b√¨nh th∆∞·ªùng, ${suspiciousCount} nghi ng·ªù, ${abnormalCount} b·∫•t th∆∞·ªùng${unclassifiedCount > 0 ? `, ${unclassifiedCount} kh√¥ng ph√¢n lo·∫°i ƒë∆∞·ª£c` : ''}`
            ].join('\n');

            return {
                classification: finalClassification,
                color: color,
                details: details,
                management: management
            };
        }

        // Ph√¢n t√≠ch g√≤ t·ª≠ cung
        function analyzeContractions() {
            const value = document.getElementById('uterine-contractions').value;
            
            if (value === '<5') {
                return { category: 'normal', description: '< 5 c∆°n/10 ph√∫t' };
            } else if (value === '>5' || value === '>2min') {
                return { category: 'suspicious', description: '‚â• 5 c∆°n/10 ph√∫t ho·∫∑c k√©o d√†i ‚â• 2 ph√∫t' };
            } else {
                return { category: 'normal', description: 'Ch∆∞a ƒë√°nh gi√°' };
            }
        }

        // Ph√¢n t√≠ch tim thai cƒÉn b·∫£n
        function analyzeFHRBaseline() {
            const baseline = document.getElementById('fhr-baseline').value;
            
            if (baseline === '<80' || baseline === '80-99' || baseline === '160-179' || baseline === '>180') {
                return { category: 'abnormal', description: `${baseline} bpm` };
            }
            
            if (baseline === '100-109') {
                const detail = document.getElementById('fhr-100-109-detail').value;
                if (detail === 'previous') {
                    return { category: 'normal', description: '100-109 bpm (ƒë√£ c√≥ t·ª´ tr∆∞·ªõc)' };
                } else if (detail === 'new') {
                    return { category: 'suspicious', description: '100-109 bpm (m·ªõi xu·∫•t hi·ªán)' };
                }
            }
            
            if (baseline === '110-160') {
                const detail = document.getElementById('fhr-110-160-detail').value;
                if (detail === 'stable') {
                    return { category: 'normal', description: '110-160 bpm, ·ªïn ƒë·ªãnh v√† ph√π h·ª£p tu·ªïi thai' };
                } else if (detail === 'unstable') {
                    return { category: 'suspicious', description: '110-160 bpm nh∆∞ng kh√¥ng ·ªïn ƒë·ªãnh' };
                } else if (detail === 'increase') {
                    return { category: 'suspicious', description: 'TƒÉng ‚â• 20 bpm so v·ªõi tr∆∞·ªõc ƒë√≥' };
                } else if (detail === 'downward') {
                    return { category: 'suspicious', description: '110-160 bpm nh∆∞ng c√≥ d·∫•u hi·ªáu ƒëi xu·ªëng d·∫ßn' };
                }
            }
            
            if (baseline === 'undefined') {
                return { category: 'suspicious', description: 'Kh√¥ng x√°c ƒë·ªãnh ƒë∆∞·ª£c baseline' };
            }
            
            return { category: 'normal', description: 'Ch∆∞a ƒë√°nh gi√°' };
        }

        // Ph√¢n t√≠ch dao ƒë·ªông n·ªôi t·∫°i
        function analyzeVariability() {
            const variability = document.getElementById('variability').value;
            
            if (variability === 'normal') {
                return { category: 'normal', description: 'B√¨nh th∆∞·ªùng (6-25 bpm)' };
            }
            
            if (variability === 'sinusoidal') {
                return { category: 'abnormal', description: 'D·∫°ng h√¨nh sin (sinusoidal)' };
            }
            
            if (variability === 'absent' || variability === 'minimal') {
                const duration = document.getElementById('variability-duration').value;
                if (duration === '30-40' || duration === '40-50') {
                    return { category: 'suspicious', description: '< 5 bpm trong 30-50 ph√∫t' };
                } else if (duration === '50-90' || duration === '>90') {
                    return { category: 'abnormal', description: '< 5 bpm > 50 ph√∫t' };
                } else {
                    return { category: 'suspicious', description: '< 5 bpm (ch∆∞a x√°c ƒë·ªãnh th·ªùi gian)' };
                }
            }
            
            if (variability === 'increased') {
                const duration = document.getElementById('variability-increased-duration').value;
                if (duration === '<10') {
                    return { category: 'suspicious', description: '> 25 bpm trong < 10 ph√∫t' };
                } else if (duration === '>10') {
                    return { category: 'abnormal', description: '> 25 bpm > 10 ph√∫t' };
                } else {
                    return { category: 'suspicious', description: '> 25 bpm (ch∆∞a x√°c ƒë·ªãnh th·ªùi gian)' };
                }
            }
            
            return { category: 'normal', description: 'Ch∆∞a ƒë√°nh gi√°' };
        }

        // Ph√¢n t√≠ch nh·ªãp gi·∫£m (c·∫≠p nh·∫≠t ƒë·ªÉ h·ªó tr·ª£ multiple)
        function analyzeDecelerations() {
            const noDecel = document.getElementById('no-decel').checked;
            const earlyDecel = document.getElementById('early-decel').checked;
            const variableDecel = document.getElementById('variable-decel').checked;
            const lateDecel = document.getElementById('late-decel').checked;
            const prolongedDecel = document.getElementById('prolonged-decel').checked;
            
            if (noDecel) {
                return { category: 'normal', description: 'Kh√¥ng c√≥ nh·ªãp gi·∫£m' };
            }
            
            // Collect all selected decelerations
            let selectedDecels = [];
            let worstCategory = 'normal';
            
            // Early deceleration
            if (earlyDecel) {
                selectedDecels.push('nh·ªãp gi·∫£m s·ªõm');
                worstCategory = 'normal'; // Early lu√¥n normal
            }
            
            // Variable deceleration
            if (variableDecel) {
                const concerningFeatures = [
                    document.getElementById('prolonged-60').checked,
                    document.getElementById('decreased-variability').checked,
                    document.getElementById('slow-return').checked,
                    document.getElementById('lost-shouldering').checked
                ].filter(Boolean).length;
                
                const repetitive = document.getElementById('variable-repetitive').value;
                const duration = document.getElementById('variable-duration').value;
                
                let varDecel = 'nh·ªãp gi·∫£m b·∫•t ƒë·ªãnh';
                const severity = document.getElementById('variable-severity').value;
                if (severity && severity.includes('severe')) {
                    varDecel += ' n·∫∑ng';
                }
                
                if (concerningFeatures > 0) {
                    varDecel += ' c√≥ ƒë·∫∑c ƒëi·ªÉm ƒë√°ng ng·∫°i';
                    
                    if (repetitive === 'repetitive') {
                        varDecel += ' l·∫∑p l·∫°i';
                        if (duration === '>30') {
                            worstCategory = updateWorstCategory(worstCategory, 'abnormal');
                        } else if (duration === '<30') {
                            worstCategory = updateWorstCategory(worstCategory, 'suspicious');
                        }
                    } else if (repetitive === 'non-repetitive') {
                        if (duration === '<30') {
                            worstCategory = updateWorstCategory(worstCategory, 'unclassified');
                        } else if (duration === '>30') {
                            worstCategory = updateWorstCategory(worstCategory, 'suspicious');
                        }
                    }
                } else {
                    worstCategory = updateWorstCategory(worstCategory, 'normal');
                }
                
                if (duration === '>30') {
                    varDecel += ' > 30 ph√∫t';
                }
                
                selectedDecels.push(varDecel);
            }
            
            // Late deceleration
            if (lateDecel) {
                const severity = document.getElementById('late-severity').value;
                const repetitive = document.getElementById('late-repetitive').value;
                const duration = document.getElementById('late-duration').value;
                
                let lateDecel = 'nh·ªãp gi·∫£m mu·ªôn';
                
                if (severity === 'mild') {
                    lateDecel += ' nh·∫π';
                    worstCategory = updateWorstCategory(worstCategory, 'unclassified');
                } else if (severity === 'severe') {
                    lateDecel += ' n·∫∑ng';
                    if (repetitive === 'repetitive') {
                        lateDecel += ' l·∫∑p l·∫°i';
                        if (duration === '>30') {
                            worstCategory = updateWorstCategory(worstCategory, 'abnormal');
                        } else if (duration === '<30') {
                            worstCategory = updateWorstCategory(worstCategory, 'suspicious');
                        }
                    }
                }
                
                selectedDecels.push(lateDecel);
            }
            
            // Prolonged deceleration (highest priority)
            if (prolongedDecel) {
                const length = document.getElementById('prolonged-length').value;
                const acuteBradycardia = document.getElementById('acute-bradycardia').value;
                const severity = document.getElementById('prolonged-severity').value;
                
                let prolongedDecel = 'nh·ªãp gi·∫£m k√©o d√†i';
                if (severity === 'severe') {
                    prolongedDecel += ' n·∫∑ng';
                }
                
                if (length === '>3' || acuteBradycardia === 'yes') {
                    worstCategory = updateWorstCategory(worstCategory, 'abnormal');
                }
                
                selectedDecels.push(prolongedDecel);
            }
            
            const description = selectedDecels.length > 0 ? selectedDecels.join(', ') : 'Ch∆∞a ƒë√°nh gi√° ƒë·∫ßy ƒë·ªß';
            
            return { category: worstCategory, description: description };
        }

        // H√†m h·ªó tr·ª£ ƒë·ªÉ c·∫≠p nh·∫≠t category x·∫•u nh·∫•t
        function updateWorstCategory(current, newCategory) {
            const hierarchy = {
                'normal': 1,
                'suspicious': 2,
                'unclassified': 3,
                'abnormal': 4
            };
            
            return hierarchy[newCategory] > hierarchy[current] ? newCategory : current;
        }

        // C·∫≠p nh·∫≠t getJapanDecelerationType ƒë·ªÉ h·ªó tr·ª£ multiple (∆∞u ti√™n theo th·ª© t·ª±)
        function getJapanDecelerationType() {
            const noDecel = document.getElementById('no-decel').checked;
            const earlyDecel = document.getElementById('early-decel').checked;
            const variableDecel = document.getElementById('variable-decel').checked;
            const lateDecel = document.getElementById('late-decel').checked;
            const prolongedDecel = document.getElementById('prolonged-decel').checked;

            if (noDecel) {
                return { type: 'none', severity: null, description: 'Kh√¥ng c√≥ nh·ªãp gi·∫£m' };
            }

            // Priority: Prolonged > Late > Variable > Early
            // Ch·ªçn lo·∫°i c√≥ priority cao nh·∫•t ƒë·ªÉ ph√¢n lo·∫°i, nh∆∞ng m√¥ t·∫£ h·∫øt
            let selectedTypes = [];
            let primaryType = null;
            
            if (earlyDecel) {
                selectedTypes.push('nh·ªãp gi·∫£m s·ªõm');
                if (!primaryType) primaryType = { type: 'early', severity: null };
            }
            
            if (variableDecel) {
                const severity = document.getElementById('variable-severity').value;
                let isSevere = severity === 'severe-70' || severity === 'severe-80';
                let varDesc = `nh·ªãp gi·∫£m b·∫•t ƒë·ªãnh ${isSevere ? 'n·∫∑ng' : 'nh·∫π'}`;
                selectedTypes.push(varDesc);
                primaryType = { type: 'variable', severity: isSevere ? 'severe' : 'mild' };
            }
            
            if (lateDecel) {
                const severity = document.getElementById('late-severity').value;
                let isSevere = severity === 'severe';
                let lateDesc = `nh·ªãp gi·∫£m mu·ªôn ${isSevere ? 'n·∫∑ng' : 'nh·∫π'}`;
                selectedTypes.push(lateDesc);
                primaryType = { type: 'late', severity: isSevere ? 'severe' : 'mild' };
            }
            
            if (prolongedDecel) {
                const severity = document.getElementById('prolonged-severity').value;
                let isSevere = severity === 'severe';
                let prolongedDesc = `nh·ªãp gi·∫£m k√©o d√†i ${isSevere ? 'n·∫∑ng' : 'nh·∫π'}`;
                selectedTypes.push(prolongedDesc);
                primaryType = { type: 'prolonged', severity: isSevere ? 'severe' : 'mild' };
            }

            const description = selectedTypes.length > 0 ? selectedTypes.join(', ') : 'Ch∆∞a x√°c ƒë·ªãnh';
            
            return {
                type: primaryType ? primaryType.type : 'none',
                severity: primaryType ? primaryType.severity : null,
                description: description
            };
        }

        // T√≠nh to√°n ph√¢n lo·∫°i Hi·ªáp h·ªôi S·∫£n ph·ª• khoa Nh·∫≠t B·∫£n (5 m·ª©c)
        function calculateJapanClassification() {
            // Ph√¢n t√≠ch c√°c th√†nh ph·∫ßn
            const baselineCategory = getJapanBaselineCategory();
            const variabilityCategory = getJapanVariabilityCategory();
            const deceleration = getJapanDecelerationType();

            // Ki·ªÉm tra Unclassified cases tr∆∞·ªõc
            if (variabilityCategory === 'marked' && 
                (deceleration.type === 'none' || deceleration.type === 'early')) {
                return {
                    level: 'Unclassified',
                    color: '#9e9e9e',
                    details: `Baseline: ${baselineCategory}\nVariability: Marked (>25 bpm)\nDeceleration: ${deceleration.description}\n\nKh√¥ng th·ªÉ ph√¢n lo·∫°i theo b·∫£ng Nh·∫≠t B·∫£n do bi·∫øn ƒë·ªông qu√° cao k·∫øt h·ª£p v·ªõi kh√¥ng c√≥ ho·∫∑c ch·ªâ c√≥ nh·ªãp gi·∫£m s·ªõm.`,
                    interpretation: 'C·∫ßn theo d√µi ch·∫∑t ch·∫Ω v√† ƒë√°nh gi√° l·∫°i. Bi·∫øn ƒë·ªông qu√° cao c√≥ th·ªÉ do nhi·ªÅu nguy√™n nh√¢n kh√°c nhau.'
                };
            }

            // T√≠nh m·ª©c ƒë·ªô d·ª±a tr√™n b·∫£ng
            let level = 1; // M·∫∑c ƒë·ªãnh

            // Logic ch√≠nh d·ª±a tr√™n b·∫£ng
            if (variabilityCategory === 'moderate') {
                if (baselineCategory === '110-160') {
                    if (deceleration.type === 'none') level = 1;
                    else if (deceleration.type === 'early') level = 2;
                    else if (deceleration.type === 'variable') {
                        level = deceleration.severity === 'mild' ? 2 : 3;
                    }
                    else if (deceleration.type === 'late') {
                        level = 3; // C·∫£ mild v√† severe ƒë·ªÅu l√† 3
                    }
                    else if (deceleration.type === 'prolonged') {
                        level = deceleration.severity === 'mild' ? 3 : 4;
                    }
                }
                else if (baselineCategory === '>160') {
                    if (deceleration.type === 'none' || deceleration.type === 'early') level = 2;
                    else if (deceleration.type === 'variable') level = 3;
                    else if (deceleration.type === 'late') {
                        level = deceleration.severity === 'mild' ? 3 : 4;
                    }
                    else if (deceleration.type === 'prolonged') {
                        level = deceleration.severity === 'mild' ? 3 : 4;
                    }
                }
                else if (baselineCategory === '80-110') {
                    if (deceleration.type === 'none' || deceleration.type === 'early') level = 3;
                    else if (deceleration.type === 'variable') {
                        level = deceleration.severity === 'mild' ? 3 : 4;
                    }
                    else if (deceleration.type === 'late' || deceleration.type === 'prolonged') level = 4;
                }
                else if (baselineCategory === '<80') {
                    level = 4; // T·∫•t c·∫£ ƒë·ªÅu l√† 4, ngo·∫°i tr√π m·ªôt s·ªë severe cases c√≥ th·ªÉ l√† 5
                    if (deceleration.type === 'variable' && deceleration.severity === 'severe') level = 5;
                }
            }
            else if (variabilityCategory === 'minimal') {
                if (baselineCategory === '110-160') {
                    if (deceleration.type === 'none' || deceleration.type === 'early') level = 3;
                    else if (deceleration.type === 'variable') {
                        level = deceleration.severity === 'mild' ? 3 : 4;
                        if (deceleration.severity === 'severe') level = 5; // T·ª´ b·∫£ng
                    }
                    else if (deceleration.type === 'late') {
                        level = deceleration.severity === 'mild' ? 3 : 4;
                    }
                    else if (deceleration.type === 'prolonged') level = 4;
                }
                else if (baselineCategory === '>160') {
                    if (deceleration.type === 'none' || deceleration.type === 'early') level = 3;
                    else if (deceleration.type === 'variable') level = 4;
                    else if (deceleration.type === 'late') {
                        level = deceleration.severity === 'mild' ? 4 : 5;
                    }
                    else if (deceleration.type === 'prolonged') level = 4;
                }
                else if (baselineCategory === '80-110' || baselineCategory === '<80') {
                    level = 5; // T·∫•t c·∫£ ƒë·ªÅu l√† 5
                }
            }
            else if (variabilityCategory === 'undetectable') {
                if (deceleration.type === 'none') level = 4;
                else level = 5; // T·∫•t c·∫£ c√°c lo·∫°i deceleration kh√°c ƒë·ªÅu l√† 5
            }
            else if (variabilityCategory === 'marked') {
                // T·ª´ b·∫£ng: Variable/Late/Prolonged v·ªõi Marked ƒë·ªÅu c√≥ ph√¢n lo·∫°i
                if (deceleration.type === 'variable') level = 3;
                else if (deceleration.type === 'late') {
                    level = deceleration.severity === 'mild' ? 3 : 4;
                }
                else if (deceleration.type === 'prolonged') {
                    level = deceleration.severity === 'mild' ? 3 : 4;
                }
            }
            else if (variabilityCategory === 'sinusoidal') {
                if (deceleration.type === 'none' || deceleration.type === 'early') level = 4;
                else if (deceleration.type === 'variable' || deceleration.type === 'prolonged') {
                    level = deceleration.severity === 'mild' ? 4 : 5;
                }
                else if (deceleration.type === 'late') level = 5;
            }

            // T·∫°o m√¥ t·∫£ chi ti·∫øt
            const details = [
                `Tim thai cƒÉn b·∫£n: ${getBaselineDescription(baselineCategory)}`,
                `Dao ƒë·ªông n·ªôi t·∫°i: ${getVariabilityDescription(variabilityCategory)}`,
                `Nh·ªãp gi·∫£m: ${deceleration.description}`,
                '',
                `M·ª©c ƒë·ªô ƒë∆∞·ª£c x√°c ƒë·ªãnh d·ª±a tr√™n b·∫£ng ph√¢n lo·∫°i 5 m·ª©c c·ªßa Hi·ªáp h·ªôi S·∫£n ph·ª• khoa Nh·∫≠t B·∫£n.`
            ].join('\n');

            // M√†u s·∫Øc theo m·ª©c ƒë·ªô
            const colors = {
                1: '#4caf50',  // Xanh l√°
                2: '#8bc34a',  // Xanh l√° nh·∫°t
                3: '#ff9800',  // Cam
                4: '#f44336',  // ƒê·ªè
                5: '#d32f2f'   // ƒê·ªè ƒë·∫≠m
            };

            // √ù nghƒ©a l√¢m s√†ng
            const interpretations = {
                1: 'M·ª©c ƒë·ªô 1: CTG b√¨nh th∆∞·ªùng, ti·∫øp t·ª•c theo d√µi th∆∞·ªùng quy.',
                2: 'M·ª©c ƒë·ªô 2: CTG g·∫ßn nh∆∞ b√¨nh th∆∞·ªùng, theo d√µi ti·∫øp t·ª•c.',
                3: 'M·ª©c ƒë·ªô 3: CTG c√≥ d·∫•u hi·ªáu b·∫•t th∆∞·ªùng nh·∫π, c·∫ßn theo d√µi ch·∫∑t ch·∫Ω.',
                4: 'M·ª©c ƒë·ªô 4: CTG b·∫•t th∆∞·ªùng, c·∫ßn can thi·ªáp v√† ƒë√°nh gi√° s·ªõm.',
                5: 'M·ª©c ƒë·ªô 5: CTG b·∫•t th∆∞·ªùng n·∫∑ng, c·∫ßn can thi·ªáp ngay l·∫≠p t·ª©c.'
            };

            return {
                level: `M·ª©c ƒë·ªô ${level}`,
                color: colors[level],
                details: details,
                interpretation: interpretations[level]
            };
        }

        // T√≠nh to√°n ph√¢n lo·∫°i theo Sinh l√Ω (Physiological Interpretation) - C·∫≠p nh·∫≠t logic
        function calculatePhysiologicalClassification() {
            // Thu th·∫≠p th√¥ng tin
            const baseline = document.getElementById('fhr-baseline').value;
            const baselineDetail = getBaselineDetail();
            const variability = document.getElementById('variability').value;
            const prolongedDecel = document.getElementById('prolonged-decel').checked;
            const prolongedLength = document.getElementById('prolonged-length').value;
            const timeInDecelMore = document.getElementById('time-in-decel-more').checked;
            const baselineRiseAfterDecel = document.getElementById('baseline-rise-after-decel').checked;
            const lostAccelerations = document.getElementById('lost-accelerations').value;
            const hasRepetitiveDecel = hasRepetitiveDecelerations();
            const sleepWakeCycle = document.getElementById('sleep-wake-cycle').value;

            // 1. Ki·ªÉm tra Acute Hypoxia tr∆∞·ªõc (∆∞u ti√™n cao nh·∫•t)
            if (prolongedDecel && prolongedLength === '>3') {
                return {
                    classification: 'Acute Hypoxia',
                    color: '#d32f2f',
                    details: 'Nh·ªãp gi·∫£m k√©o d√†i > 3 ph√∫t\n\nƒê√¢y l√† d·∫•u hi·ªáu thi·∫øu oxy c·∫•p t√≠nh, c·∫ßn can thi·ªáp ngay l·∫≠p t·ª©c.',
                    management: 'Lo·∫°i tr·ª´ 3 tai bi·∫øn c·∫•p (r·ªëi lo·∫°n cu·ªëng r·ªën, nhau bong non, v·ª° t·ª≠ cung)\n‚Ä¢ N·∫øu nghi ng·ªù tai bi·∫øn ‚Üí chu·∫©n b·ªã sinh ngay l·∫≠p t·ª©c\n‚Ä¢ ƒêi·ªÅu ch·ªânh nguy√™n nh√¢n c√≥ th·ªÉ ph·ª•c h·ªìi\n‚Ä¢ N·∫øu kh√¥ng c·∫£i thi·ªán trong 9 ph√∫t ho·∫∑c b·∫•t k·ª≥ tai bi·∫øn n√†o ƒë∆∞·ª£c ch·∫©n ƒëo√°n ‚Üí sinh ngay l·∫≠p t·ª©c b·∫±ng ƒë∆∞·ªùng nhanh nh·∫•t v√† an to√†n nh·∫•t'
                };
            }

            // 2. Ki·ªÉm tra Subacute Hypoxia
            if (timeInDecelMore) {
                let features = ['Th·ªùi gian trong nh·ªãp gi·∫£m > th·ªùi gian ·ªü baseline'];
                
                if (variability === 'increased') {
                    features.push('K√®m theo bi·∫øn ƒë·ªông tƒÉng (saltatory pattern)');
                }

                return {
                    classification: 'Subacute Hypoxia',
                    color: '#f44336',
                    details: features.join('\n') + '\n\nD·∫•u hi·ªáu thi·∫øu oxy b√°n c·∫•p, c·∫ßn can thi·ªáp s·ªõm.',
                    management: 'Giai ƒëo·∫°n 1:\n‚Ä¢ Ng·ª´ng prostaglandin/ng·ª´ng truy·ªÅn oxytocin\n‚Ä¢ N·∫øu kh√¥ng c·∫£i thi·ªán ‚Üí c·∫ßn sinh con ngay\n‚Ä¢ N·∫øu v·∫´n kh√¥ng c√≥ b·∫±ng ch·ª©ng c·∫£i thi·ªán trong 10-15 ph√∫t ‚Üí ƒë√°nh gi√° l·∫°i t√¨nh h√¨nh v√† th√∫c sinh con\n\nGiai ƒëo·∫°n 2:\n‚Ä¢ Ng·ª´ng m·∫π √©p trong c√°c c∆°n co cho ƒë·∫øn khi c√≥ c·∫£i thi·ªán\n‚Ä¢ N·∫øu kh√¥ng c·∫£i thi·ªán ‚Üí xem x√©t sinh con n·∫øu sinh con kh√¥ng s·∫Øp x·∫£y ra ho·∫∑c th√∫c sinh con b·∫±ng ph·∫´u thu·∫≠t'
                };
            }

            // 3. Ki·ªÉm tra No Hypoxia
            if (isNormalCTG()) {
                return {
                    classification: 'No Hypoxia',
                    color: '#4caf50',
                    details: 'Baseline ph√π h·ª£p tu·ªïi thai (110-160 bpm ·ªïn ƒë·ªãnh)\nDao ƒë·ªông n·ªôi t·∫°i b√¨nh th∆∞·ªùng (6-25 bpm)\nKh√¥ng c√≥ nh·ªãp gi·∫£m l·∫∑p l·∫°i\n\nCTG b√¨nh th∆∞·ªùng, kh√¥ng c√≥ d·∫•u hi·ªáu thi·∫øu oxy.',
                    management: 'Xem x√©t li·ªáu CTG c√≥ c·∫ßn ti·∫øp t·ª•c kh√¥ng\nN·∫øu ti·∫øp t·ª•c CTG, th·ª±c hi·ªán ƒë√°nh gi√° th∆∞·ªùng quy h√†ng gi·ªù'
                };
            }

            // 4. Ki·ªÉm tra Gradually Evolving Hypoxia
            const hasBaselineRise = checkBaselineRise();
            const hasSignsOfHypoxia = baselineRiseAfterDecel || hasRepetitiveDecel || lostAccelerations === 'yes';
            
            if (hasSignsOfHypoxia) {
                // Ph√¢n bi·ªát Compensated vs Decompensated
                const isDecompensated = checkDecompensated();
                
                if (isDecompensated) {
                    return {
                        classification: 'Gradually Evolving Hypoxia - Decompensated',
                        color: '#f44336',
                        details: getDecompensatedFeatures(),
                        management: 'C·∫ßn can thi·ªáp kh·∫©n c·∫•p ƒë·ªÉ ƒë·∫£o ng∆∞·ª£c t√¨nh tr·∫°ng thi·∫øu oxy (ng·ª´ng prostaglandin, ng·ª´ng truy·ªÅn oxytocin, sinh con nhanh)\nN√™n th√∫c sinh con n·∫øu kh√¥ng th·∫•y d·∫•u hi·ªáu c·∫£i thi·ªán'
                    };
                } else {
                    return {
                        classification: 'Gradually Evolving Hypoxia - Compensated',
                        color: '#ff9800',
                        details: getCompensatedFeatures(),
                        management: 'C√≥ kh·∫£ nƒÉng ƒë√°p ·ª©ng v·ªõi c√°c can thi·ªáp b·∫£o t·ªìn\nƒê√°nh gi√° l·∫°i th∆∞·ªùng xuy√™n m·ªói 30-60 ph√∫t ƒë·ªÉ ƒë√°nh gi√° c√°c d·∫•u hi·ªáu ti·∫øn tri·ªÉn thi·∫øu oxy ti·∫øp theo v√† can thi·ªáp c√≥ c·∫£i thi·ªán hay kh√¥ng\nC√°c nguy√™n nh√¢n kh√°c nh∆∞ gi·∫£m d·ª± tr·ªØ nhau thai PH·∫¢I ƒë∆∞·ª£c xem x√©t v√† gi·∫£i quy·∫øt ph√π h·ª£p'
                    };
                }
            }

            // 5. Tr∆∞·ªùng h·ª£p c√≥ repetitive decelerations nh∆∞ng ch∆∞a ƒë·ªß ti√™u chu·∫©n Gradually Evolving
            if (hasRepetitiveDecel && !hasBaselineRise && !baselineRiseAfterDecel && lostAccelerations !== 'yes') {
                return {
                    classification: 'Thai c√≥ d·∫•u hi·ªáu b·∫Øt ƒë·∫ßu thi·∫øu oxy',
                    color: '#ff9800',
                    details: 'C√≥ nh·ªãp gi·∫£m l·∫∑p l·∫°i nh∆∞ng ch∆∞a c√≥ baseline tƒÉng ho·∫∑c m·∫•t nh·ªãp tƒÉng\n\nD·∫•u hi·ªáu s·ªõm c·ªßa thi·∫øu oxy, c·∫ßn theo d√µi ch·∫∑t ch·∫Ω.',
                    management: 'Theo d√µi ch·∫∑t ch·∫Ω v√† ƒë√°nh gi√° l·∫°i th∆∞·ªùng xuy√™n\nChu·∫©n b·ªã can thi·ªáp n·∫øu c√≥ d·∫•u hi·ªáu ti·∫øn tri·ªÉn\nXem x√©t c√°c y·∫øu t·ªë nguy c∆° kh√°c'
                };
            }

            // M·∫∑c ƒë·ªãnh: Kh√¥ng x√°c ƒë·ªãnh r√µ
            return {
                classification: 'Kh√¥ng x√°c ƒë·ªãnh r√µ',
                color: '#9e9e9e',
                details: 'Kh√¥ng ƒë·ªß th√¥ng tin ƒë·ªÉ ph√¢n lo·∫°i theo sinh l√Ω ho·∫∑c c√≥ ƒë·∫∑c ƒëi·ªÉm kh√¥ng ƒëi·ªÉn h√¨nh.',
                management: 'C·∫ßn theo d√µi ch·∫∑t ch·∫Ω v√† ƒë√°nh gi√° l·∫°i. Xem x√©t c√°c y·∫øu t·ªë l√¢m s√†ng kh√°c.'
            };
        }

        // C·∫≠p nh·∫≠t h√†m h·ªó tr·ª£
        function checkDecompensated() {
            const variability = document.getElementById('variability').value;
            const baseline = document.getElementById('fhr-baseline').value;
            const baselineDetail = getBaselineDetail();
            const hasBaselineRise = checkBaselineRise();
            
            // N·∫øu c√≥ baseline tƒÉng NH∆ØNG variability abnormal ‚Üí Decompensated
            if (hasBaselineRise && (variability === 'absent' || variability === 'minimal' || variability === 'increased')) {
                return true;
            }
            
            // Dao ƒë·ªông gi·∫£m ho·∫∑c tƒÉng
            if (variability === 'absent' || variability === 'minimal' || variability === 'increased') {
                return true;
            }
            
            // Baseline kh√¥ng ·ªïn ƒë·ªãnh ho·∫∑c ƒëi xu·ªëng
            if (baseline === '110-160' && (baselineDetail === 'unstable' || baselineDetail === 'downward')) {
                return true;
            }
            
            // Baseline ch·∫≠m < 110
            if (baseline === '<80' || baseline === '80-99' || baseline === '100-109') {
                return true;
            }
            
            return false;
        }

        function getCompensatedFeatures() {
            let features = [];
            
            const baselineRiseAfterDecel = document.getElementById('baseline-rise-after-decel').checked;
            const hasBaselineRise = checkBaselineRise();
            const variability = document.getElementById('variability').value;
            
            if (baselineRiseAfterDecel) {
                features.push('Tim thai cƒÉn b·∫£n tƒÉng sau khi xu·∫•t hi·ªán nh·ªãp gi·∫£m');
            }
            
            if (hasBaselineRise) {
                features.push('Baseline tƒÉng');
            }
            
            if (variability === 'normal') {
                features.push('Dao ƒë·ªông n·ªôi t·∫°i b√¨nh th∆∞·ªùng');
            }
            
            const baselineDetail = getBaselineDetail();
            if (baselineDetail === 'stable') {
                features.push('Baseline ·ªïn ƒë·ªãnh');
            }
            
            if (hasRepetitiveDecelerations()) {
                features.push('C√≥ nh·ªãp gi·∫£m l·∫∑p l·∫°i');
            }
            
            const lostAccelerations = document.getElementById('lost-accelerations').value;
            if (lostAccelerations === 'yes') {
                features.push('M·∫•t nh·ªãp tƒÉng sau nh·ªØng nh·ªãp gi·∫£m');
                
                // Ki·ªÉm tra chu k·ª≥ t·ªânh-ng·ªß
                const sleepWakeCycle = document.getElementById('sleep-wake-cycle').value;
                if (sleepWakeCycle === 'yes') {
                    features.push('(M·∫•t nh·ªãp tƒÉng trong giai ƒëo·∫°n ng·ªß √≠t ƒë√°ng ng·∫°i h∆°n)');
                }
            }
            
            return features.join('\n') + '\n\nThi·∫øu oxy di·ªÖn ti·∫øn d·∫ßn nh∆∞ng c√≤n b√π tr·ª´ ƒë∆∞·ª£c.';
        }

        function getDecompensatedFeatures() {
            let features = [];
            
            const variability = document.getElementById('variability').value;
            if (variability === 'absent' || variability === 'minimal') {
                features.push('Dao ƒë·ªông n·ªôi t·∫°i gi·∫£m');
            } else if (variability === 'increased') {
                features.push('Dao ƒë·ªông n·ªôi t·∫°i tƒÉng');
            }
            
            const baseline = document.getElementById('fhr-baseline').value;
            const baselineDetail = getBaselineDetail();
            
            if (baseline === '110-160' && baselineDetail === 'unstable') {
                features.push('Baseline kh√¥ng ·ªïn ƒë·ªãnh');
            } else if (baseline === '110-160' && baselineDetail === 'downward') {
                features.push('Baseline c√≥ xu h∆∞·ªõng ƒëi xu·ªëng d·∫ßn (step ladder pattern to death)');
            } else if (baseline === '<80' || baseline === '80-99' || baseline === '100-109') {
                features.push('Baseline ch·∫≠m < 110 bpm');
            }
            
            const baselineRiseAfterDecel = document.getElementById('baseline-rise-after-decel').checked;
            if (baselineRiseAfterDecel) {
                features.push('Tim thai cƒÉn b·∫£n tƒÉng sau khi xu·∫•t hi·ªán nh·ªãp gi·∫£m');
            }
            
            if (hasRepetitiveDecelerations()) {
                features.push('C√≥ nh·ªãp gi·∫£m l·∫∑p l·∫°i');
            }
            
            return features.join('\n') + '\n\nThi·∫øu oxy di·ªÖn ti·∫øn d·∫ßn v√† ƒë√£ m·∫•t b√π tr·ª´.';
        }

        // T√≠nh to√°n ph√¢n lo·∫°i FIGO 2015
        function calculateFIGOClassification() {
            const baseline = document.getElementById('fhr-baseline').value;
            const variability = document.getElementById('variability').value;
            const noDecel = document.getElementById('no-decel').checked;
            const prolongedDecel = document.getElementById('prolonged-decel').checked;
            const prolongedLength = document.getElementById('prolonged-length').value;
            const lateDecel = document.getElementById('late-decel').checked;
            const lateSeverity = document.getElementById('late-severity').value;
            const lateRepetitive = document.getElementById('late-repetitive').value;
            const lateDuration = document.getElementById('late-duration').value;
            const accelerations = document.getElementById('accelerations').value;
            
            // Ki·ªÉm tra Pathological tr∆∞·ªõc (∆∞u ti√™n cao nh·∫•t)
            let pathologicalFeatures = [];
            
            // 1. Baseline < 100 bpm
            if (baseline === '<80' || baseline === '80-99') {
                pathologicalFeatures.push('Baseline < 100 bpm');
            }
            
            // 2. Reduced/Increased variability ho·∫∑c Sinusoidal
            if (variability === 'absent' || variability === 'minimal') {
                pathologicalFeatures.push('Dao ƒë·ªông n·ªôi t·∫°i gi·∫£m');
            } else if (variability === 'increased') {
                pathologicalFeatures.push('Dao ƒë·ªông n·ªôi t·∫°i tƒÉng');
            } else if (variability === 'sinusoidal') {
                pathologicalFeatures.push('Bi·ªÉu ƒë·ªì d·∫°ng h√¨nh sin');
            }
            
            // 3. Repetitive late ho·∫∑c prolonged decelerations for > 30 min (or > 20 min if reduced variability)
            if (lateDecel && lateSeverity === 'severe' && lateRepetitive === 'repetitive') {
                const timeThreshold = (variability === 'absent' || variability === 'minimal') ? '<30' : '>30';
                if (lateDuration === '>30' || (timeThreshold === '<30' && lateDuration === '<30')) {
                    let duration = lateDuration === '>30' ? '> 30 ph√∫t' : '> 20 ph√∫t (do c√≥ dao ƒë·ªông gi·∫£m)';
                    pathologicalFeatures.push(`Nh·ªãp gi·∫£m mu·ªôn n·∫∑ng l·∫∑p l·∫°i ${duration}`);
                }
            }
            
            // Prolonged decelerations l·∫∑p l·∫°i
            if (prolongedDecel) {
                // Ki·ªÉm tra c√≥ ph·∫£i prolonged deceleration > 5 min kh√¥ng
                if (prolongedLength === '>3') {
                    pathologicalFeatures.push('Nh·ªãp gi·∫£m k√©o d√†i > 5 ph√∫t');
                } else {
                    // Ki·ªÉm tra repetitive prolonged v·ªõi th·ªùi gian
                    // (C·∫ßn th√™m logic ƒë·ªÉ check repetitive prolonged)
                    pathologicalFeatures.push('Nh·ªãp gi·∫£m k√©o d√†i l·∫∑p l·∫°i');
                }
            }
            
            if (pathologicalFeatures.length > 0) {
                return {
                    classification: 'Pathological',
                    color: '#f44336',
                    details: 'ƒê·∫∑c ƒëi·ªÉm Pathological:\n‚Ä¢ ' + pathologicalFeatures.join('\n‚Ä¢ ') + '\n\nX√°c su·∫•t cao thi·∫øu oxy/toan h√≥a.',
                    management: 'H√†nh ƒë·ªông ngay l·∫≠p t·ª©c ƒë·ªÉ ƒëi·ªÅu ch·ªânh c√°c nguy√™n nh√¢n c√≥ th·ªÉ ƒë·∫£o ng∆∞·ª£c, c√°c ph∆∞∆°ng ph√°p ph·ª• tr·ª£, ho·∫∑c n·∫øu ƒëi·ªÅu n√†y kh√¥ng kh·∫£ thi th√¨ th√∫c sinh con. Trong c√°c t√¨nh hu·ªëng c·∫•p c·ª©u, sinh con ngay l·∫≠p t·ª©c n√™n ƒë∆∞·ª£c th·ª±c hi·ªán.'
                };
            }
            
            // Ki·ªÉm tra Normal
            let normalCriteria = [];
            let failedNormalCriteria = [];
            
            // 1. Baseline 110-160 bpm
            if (baseline === '110-160') {
                const detail = document.getElementById('fhr-110-160-detail').value;
                if (detail === 'stable') {
                    normalCriteria.push('Baseline 110-160 bpm ·ªïn ƒë·ªãnh');
                } else {
                    failedNormalCriteria.push('Baseline kh√¥ng ·ªïn ƒë·ªãnh');
                }
            } else {
                failedNormalCriteria.push('Baseline kh√¥ng trong kho·∫£ng 110-160 bpm');
            }
            
            // 2. Variability 5-25 bpm
            if (variability === 'normal') {
                normalCriteria.push('Dao ƒë·ªông n·ªôi t·∫°i 5-25 bpm');
            } else {
                failedNormalCriteria.push('Dao ƒë·ªông n·ªôi t·∫°i kh√¥ng b√¨nh th∆∞·ªùng');
            }
            
            // 3. No repetitive decelerations
            const hasRepetitiveDecel = hasRepetitiveDecelerations();
            if (!hasRepetitiveDecel) {
                normalCriteria.push('Kh√¥ng c√≥ nh·ªãp gi·∫£m l·∫∑p l·∫°i');
            } else {
                failedNormalCriteria.push('C√≥ nh·ªãp gi·∫£m l·∫∑p l·∫°i');
            }
            
            // Ki·ªÉm tra absence of accelerations
            let accelerationNote = '';
            if (accelerations === 'no') {
                accelerationNote = '\n\nL∆∞u √Ω: M·∫•t nh·ªãp tƒÉng trong chuy·ªÉn d·∫° c√≥ √Ω nghƒ©a kh√¥ng r√µ r√†ng.';
            }
            
            if (normalCriteria.length === 3 && failedNormalCriteria.length === 0) {
                return {
                    classification: 'Normal',
                    color: '#4caf50',
                    details: 'ƒê·ªß 3/3 ti√™u chu·∫©n Normal:\n‚Ä¢ ' + normalCriteria.join('\n‚Ä¢ ') + accelerationNote + '\n\nKh√¥ng c√≥ thi·∫øu oxy/toan h√≥a.',
                    management: 'Kh√¥ng c·∫ßn can thi·ªáp ƒë·ªÉ c·∫£i thi·ªán t√¨nh tr·∫°ng oxy h√≥a thai nhi.'
                };
            }
            
            // N·∫øu kh√¥ng ƒë·ªß ti√™u chu·∫©n Normal v√† kh√¥ng c√≥ ƒë·∫∑c ƒëi·ªÉm Pathological ‚Üí Suspicious
            return {
                classification: 'Suspicious',
                color: '#ff9800',
                details: 'Thi·∫øu √≠t nh·∫•t 1 ƒë·∫∑c ƒëi·ªÉm c·ªßa Normal nh∆∞ng kh√¥ng c√≥ ƒë·∫∑c ƒëi·ªÉm Pathological:\n\nTi√™u chu·∫©n Normal ƒë·∫°t ƒë∆∞·ª£c:\n‚Ä¢ ' + 
                         normalCriteria.join('\n‚Ä¢ ') + 
                         '\n\nTi√™u chu·∫©n Normal kh√¥ng ƒë·∫°t:\n‚Ä¢ ' + 
                         failedNormalCriteria.join('\n‚Ä¢ ') + 
                         accelerationNote + '\n\nX√°c su·∫•t th·∫•p thi·∫øu oxy/toan h√≥a.',
                management: 'H√†nh ƒë·ªông ƒë·ªÉ ƒëi·ªÅu ch·ªânh c√°c nguy√™n nh√¢n c√≥ th·ªÉ ƒë·∫£o ng∆∞·ª£c n·∫øu ƒë∆∞·ª£c x√°c ƒë·ªãnh, theo d√µi s√°t ho·∫∑c c√°c ph∆∞∆°ng ph√°p ph·ª• tr·ª£.'
            };
        }

        // H√†m h·ªó tr·ª£ cho ph√¢n lo·∫°i sinh l√Ω
        function getBaselineDetail() {
            const baseline = document.getElementById('fhr-baseline').value;
            if (baseline === '110-160') {
                return document.getElementById('fhr-110-160-detail').value;
            } else if (baseline === '100-109') {
                return document.getElementById('fhr-100-109-detail').value;
            }
            return null;
        }

        function checkBaselineRise() {
            const baseline = document.getElementById('fhr-baseline').value;
            const detail = getBaselineDetail();
            
            // Tim thai nhanh (>160)
            if (baseline === '160-179' || baseline === '>180') {
                return true;
            }
            
            // TƒÉng >= 20 bpm ho·∫∑c 10% so v·ªõi tr∆∞·ªõc ƒë√≥
            if (baseline === '110-160' && detail === 'increase') {
                return true;
            }
            
            return false;
        }

        function hasRepetitiveDecelerations() {
            // Ki·ªÉm tra nh·ªãp gi·∫£m mu·ªôn l·∫∑p l·∫°i
            if (document.getElementById('late-decel').checked) {
                const repetitive = document.getElementById('late-repetitive').value;
                if (repetitive === 'repetitive') return true;
            }
            
            // Ki·ªÉm tra nh·ªãp gi·∫£m b·∫•t ƒë·ªãnh l·∫∑p l·∫°i
            if (document.getElementById('variable-decel').checked) {
                const repetitive = document.getElementById('variable-repetitive').value;
                if (repetitive === 'repetitive') return true;
            }
            
            return false;
        }

        function isNormalCTG() {
            const baseline = document.getElementById('fhr-baseline').value;
            const variability = document.getElementById('variability').value;
            const noDecel = document.getElementById('no-decel').checked;
            
            // Baseline ph√π h·ª£p tu·ªïi thai (110-160)
            if (baseline !== '110-160') return false;
            
            const detail = document.getElementById('fhr-110-160-detail').value;
            if (detail !== 'stable') return false;
            
            // Dao ƒë·ªông b√¨nh th∆∞·ªùng
            if (variability !== 'normal') return false;
            
            // Kh√¥ng c√≥ nh·ªãp gi·∫£m l·∫∑p l·∫°i
            if (!noDecel && hasRepetitiveDecelerations()) return false;
            
            return true;
        }

        function checkDecompensated() {
            const variability = document.getElementById('variability').value;
            const baseline = document.getElementById('fhr-baseline').value;
            const baselineDetail = getBaselineDetail();
            
            // Dao ƒë·ªông gi·∫£m ho·∫∑c tƒÉng
            if (variability === 'absent' || variability === 'minimal' || variability === 'increased') {
                return true;
            }
            
            // Baseline kh√¥ng ·ªïn ƒë·ªãnh ho·∫∑c ƒëi xu·ªëng
            if (baseline === '110-160' && (baselineDetail === 'unstable' || baselineDetail === 'downward')) {
                return true;
            }
            
            // Baseline ch·∫≠m < 110
            if (baseline === '<80' || baseline === '80-99' || baseline === '100-109') {
                return true;
            }
            
            return false;
        }

        function getCompensatedFeatures() {
            let features = [];
            
            if (checkBaselineRise()) {
                features.push('TƒÉng baseline v·ªõi dao ƒë·ªông b√¨nh th∆∞·ªùng v√† baseline ·ªïn ƒë·ªãnh');
            }
            
            features.push('C√≥ nh·ªãp gi·∫£m v√† m·∫•t nh·ªãp tƒÉng');
            
            if (hasRepetitiveDecelerations()) {
                features.push('C√≥ nh·ªãp gi·∫£m l·∫∑p l·∫°i');
            }
            
            const lostAccelerations = document.getElementById('lost-accelerations').value;
            if (lostAccelerations === 'yes') {
                features.push('M·∫•t nh·ªãp tƒÉng sau nh·ªØng nh·ªãp gi·∫£m');
            }
            
            return features.join('\n') + '\n\nThi·∫øu oxy di·ªÖn ti·∫øn d·∫ßn nh∆∞ng c√≤n b√π tr·ª´ ƒë∆∞·ª£c.';
        }

        function getDecompensatedFeatures() {
            let features = [];
            
            const variability = document.getElementById('variability').value;
            if (variability === 'absent' || variability === 'minimal') {
                features.push('Dao ƒë·ªông n·ªôi t·∫°i gi·∫£m');
            } else if (variability === 'increased') {
                features.push('Dao ƒë·ªông n·ªôi t·∫°i tƒÉng');
            }
            
            const baseline = document.getElementById('fhr-baseline').value;
            const baselineDetail = getBaselineDetail();
            
            if (baseline === '110-160' && baselineDetail === 'unstable') {
                features.push('Baseline kh√¥ng ·ªïn ƒë·ªãnh');
            } else if (baseline === '110-160' && baselineDetail === 'downward') {
                features.push('Baseline c√≥ xu h∆∞·ªõng ƒëi xu·ªëng d·∫ßn (step ladder pattern to death)');
            } else if (baseline === '<80' || baseline === '80-99' || baseline === '100-109') {
                features.push('Baseline ch·∫≠m < 110 bpm');
            }
            
            return features.join('\n') + '\n\nThi·∫øu oxy di·ªÖn ti·∫øn d·∫ßn v√† ƒë√£ m·∫•t b√π tr·ª´.';
        }

        // H√†m h·ªó tr·ª£ cho ph√¢n lo·∫°i Nh·∫≠t B·∫£n
        function getJapanBaselineCategory() {
            const baseline = document.getElementById('fhr-baseline').value;
            if (baseline === '<80') return '<80';
            if (baseline === '80-99' || baseline === '100-109') return '80-110';
            if (baseline === '110-160') return '110-160';
            if (baseline === '160-179' || baseline === '>180') return '>160';
            return '110-160'; // default
        }

        function getJapanVariabilityCategory() {
            const variability = document.getElementById('variability').value;
            if (variability === 'absent') return 'undetectable'; // <3 bpm
            if (variability === 'minimal') return 'minimal'; // 3-5 bpm
            if (variability === 'normal') return 'moderate'; // 6-25 bpm
            if (variability === 'increased') return 'marked'; // >25 bpm
            if (variability === 'sinusoidal') return 'sinusoidal';
            return 'moderate'; // default
        }

        function getJapanDecelerationType() {
            const noDecel = document.getElementById('no-decel').checked;
            const earlyDecel = document.getElementById('early-decel').checked;
            const variableDecel = document.getElementById('variable-decel').checked;
            const lateDecel = document.getElementById('late-decel').checked;
            const prolongedDecel = document.getElementById('prolonged-decel').checked;

            if (noDecel) {
                return { type: 'none', severity: null, description: 'Kh√¥ng c√≥ nh·ªãp gi·∫£m' };
            }

            if (earlyDecel && !variableDecel && !lateDecel && !prolongedDecel) {
                return { type: 'early', severity: null, description: 'Nh·ªãp gi·∫£m s·ªõm' };
            }

            if (variableDecel) {
                // Ki·ªÉm tra severe variable d·ª±a tr√™n ƒë·ªãnh nghƒ©a Nh·∫≠t B·∫£n
                const severity = document.getElementById('variable-severity').value;
                let isSevere = false;
                
                if (severity === 'severe-70' || severity === 'severe-80') {
                    isSevere = true;
                }

                return {
                    type: 'variable',
                    severity: isSevere ? 'severe' : 'mild',
                    description: `Nh·ªãp gi·∫£m b·∫•t ƒë·ªãnh ${isSevere ? 'n·∫∑ng' : 'nh·∫π'}`
                };
            }

            if (lateDecel) {
                const severity = document.getElementById('late-severity').value;
                const isSevere = severity === 'severe'; // gi·∫£m > 15 bpm

                return {
                    type: 'late',
                    severity: isSevere ? 'severe' : 'mild',
                    description: `Nh·ªãp gi·∫£m mu·ªôn ${isSevere ? 'n·∫∑ng' : 'nh·∫π'}`
                };
            }

            if (prolongedDecel) {
                const severity = document.getElementById('prolonged-severity').value;
                const isSevere = severity === 'severe'; // Nadir < 80 bpm

                return {
                    type: 'prolonged',
                    severity: isSevere ? 'severe' : 'mild',
                    description: `Nh·ªãp gi·∫£m k√©o d√†i ${isSevere ? 'n·∫∑ng' : 'nh·∫π'}`
                };
            }

            return { type: 'none', severity: null, description: 'Ch∆∞a x√°c ƒë·ªãnh' };
        }

        function getBaselineDescription(category) {
            const map = {
                '<80': '< 80 bpm',
                '80-110': '80-110 bpm',
                '110-160': '110-160 bpm',
                '>160': '> 160 bpm'
            };
            return map[category] || category;
        }

        function getVariabilityDescription(category) {
            const map = {
                'undetectable': 'Kh√¥ng ph√°t hi·ªán ƒë∆∞·ª£c (< 3 bpm)',
                'minimal': 'T·ªëi thi·ªÉu (3-5 bpm)',
                'moderate': 'V·ª´a ph·∫£i (6-25 bpm)',
                'marked': 'R√µ r·ªát (> 25 bpm)',
                'sinusoidal': 'D·∫°ng h√¨nh sin'
            };
            return map[category] || category;
        }

        // C√°c h√†m x·ª≠ l√Ω n√∫t
        function saveAndAnalyzeCTG() {
            updateSummary();
            
            // Hi·ªÉn th·ªã k·∫øt qu·∫£ ph√¢n t√≠ch (theo alphabetical order)
            const acogClassification = calculateACOGClassification();
            const figoClassification = calculateFIGOClassification();
            const japanClassification = calculateJapanClassification();
            const niceClassification = calculateNICEClassification();
            const physioClassification = calculatePhysiologicalClassification();
            
            // ACOG 2009
            document.getElementById('acog-classification').value = acogClassification.group;
            document.getElementById('acog-details').value = acogClassification.details;
            
            // FIGO 2015
            document.getElementById('figo-classification').value = figoClassification.classification;
            document.getElementById('figo-classification').style.color = figoClassification.color;
            document.getElementById('figo-details').value = figoClassification.details;
            document.getElementById('figo-management').value = figoClassification.management;
            
            // Japan
            document.getElementById('japan-classification').value = japanClassification.level;
            document.getElementById('japan-classification').style.color = japanClassification.color;
            document.getElementById('japan-details').value = japanClassification.details;
            document.getElementById('japan-interpretation').value = japanClassification.interpretation;
            
            // NICE 2022
            document.getElementById('nice-classification').value = niceClassification.classification;
            document.getElementById('nice-classification').style.color = niceClassification.color;
            document.getElementById('nice-details').value = niceClassification.details;
            document.getElementById('nice-management').value = niceClassification.management;
            
            // Physiological
            document.getElementById('physio-classification').value = physioClassification.classification;
            document.getElementById('physio-classification').style.color = physioClassification.color;
            document.getElementById('physio-details').value = physioClassification.details;
            document.getElementById('physio-management').value = physioClassification.management;
            
            // Hi·ªÉn th·ªã section k·∫øt qu·∫£
            document.getElementById('analysis-results').classList.remove('hidden');
            
            // Scroll ƒë·∫øn k·∫øt qu·∫£
            document.getElementById('analysis-results').scrollIntoView({ behavior: 'smooth' });
            
            // Upload l√™n Google Sheet
            uploadToGoogleSheet({
                acog: acogClassification.group,
                figo: figoClassification.classification,
                japan: japanClassification.level,
                nice: niceClassification.classification,
                physiological: physioClassification.classification
            });
            
            alert('üéâ ƒê√£ ph√¢n t√≠ch CTG th√†nh c√¥ng theo 5 h·ªá th·ªëng: ACOG 2009, FIGO 2015, Hi·ªáp h·ªôi S·∫£n ph·ª• khoa Nh·∫≠t B·∫£n, NICE 2022 v√† Ph√¢n lo·∫°i Sinh l√Ω!');
        }

        // H√†m upload d·ªØ li·ªáu l√™n Google Sheet
        function uploadToGoogleSheet(classifications) {
            // ===== CONFIG: Thay ƒë·ªïi URL Google Apps Script c·ªßa b·∫°n ·ªü ƒë√¢y =====
            const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwDyCF1qQ8wkdppnoRuLA69bkOi9hT-EF5EoNdnQgQTTj4ttBg3Gk5nW-oWSijm7-0DVw/exec";
            // ===================================================================
            
            try {
                // Thu th·∫≠p d·ªØ li·ªáu t·ª´ form
                const patientId = document.getElementById('patient-id').value;
                const diagnosis = document.getElementById('diagnosis').value;
                const apgar1 = document.getElementById('apgar-1').value;
                const apgar2 = document.getElementById('apgar-2').value;
                const phLevel = document.getElementById('ph-level').value;
                
                // L·∫•y ·∫£nh CTG (base64)
                const ctgBeforeImg = document.querySelector('#preview-before img');
                const ctgCurrentImg = document.querySelector('#preview-current img');
                
                const ctgBefore = ctgBeforeImg ? ctgBeforeImg.src : null;
                const ctgCurrent = ctgCurrentImg ? ctgCurrentImg.src : null;
                
                // T·∫°o payload
                const payload = {
                    timestamp: new Date().toISOString(),
                    patientId: patientId,
                    diagnosis: diagnosis,
                    ctgBefore: ctgBefore,
                    ctgCurrent: ctgCurrent,
                    classifications: {
                        nice: classifications.nice,
                        acog: classifications.acog,
                        rcog: '', // Placeholder for RCOG if needed
                        figo: classifications.figo,
                        japan: classifications.japan,
                        physiological: classifications.physiological
                    },
                    apgar1: apgar1,
                    apgar2: apgar2,
                    phLevel: phLevel
                };
                
                console.log('Uploading to Google Sheet:', payload);
                
                // G·ª≠i d·ªØ li·ªáu
                fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(payload)
                })
                .then(() => {
                    console.log('‚úÖ D·ªØ li·ªáu ƒë√£ ƒë∆∞·ª£c g·ª≠i l√™n Google Sheet');
                    // Hi·ªÉn th·ªã th√¥ng b√°o nh·ªè
                    showNotification('üìä ƒê√£ l∆∞u d·ªØ li·ªáu l√™n Google Sheet', 'success');
                })
                .catch((error) => {
                    console.error('‚ùå L·ªói khi upload l√™n Google Sheet:', error);
                    showNotification('‚ö†Ô∏è L·ªói khi l∆∞u l√™n Google Sheet', 'error');
                });
                
            } catch (error) {
                console.error('‚ùå L·ªói khi chu·∫©n b·ªã d·ªØ li·ªáu:', error);
                showNotification('‚ö†Ô∏è L·ªói khi chu·∫©n b·ªã d·ªØ li·ªáu', 'error');
            }
        }

        // H√†m hi·ªÉn th·ªã th√¥ng b√°o
        function showNotification(message, type) {
            // T·∫°o element th√¥ng b√°o
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 20px;
                border-radius: 8px;
                color: white;
                font-weight: 600;
                z-index: 10000;
                max-width: 300px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                transition: all 0.3s ease;
                background: ${type === 'success' ? '#4caf50' : '#f44336'};
            `;
            notification.textContent = message;
            
            // Th√™m v√†o DOM
            document.body.appendChild(notification);
            
            // Auto remove sau 4 gi√¢y
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 4000);
        }

        function exportPDF() {
            try {
                // T·∫°o n·ªôi dung PDF b·∫±ng HTML tr∆∞·ªõc
                createPDFContent();
                
            } catch (error) {
                console.error('L·ªói khi xu·∫•t PDF:', error);
                showNotification('‚ùå L·ªói khi xu·∫•t PDF: ' + error.message, 'error');
            }
        }

        function createPDFContent() {
            // T·∫°o div ·∫©n ch·ª©a n·ªôi dung PDF
            const pdfContent = document.createElement('div');
            pdfContent.id = 'pdf-content';
            pdfContent.style.cssText = `
                position: absolute;
                left: -9999px;
                width: 210mm;
                background: white;
                padding: 20px;
                font-family: 'Times New Roman', serif;
                font-size: 14px;
                line-height: 1.6;
                color: black;
            `;

            // Thu th·∫≠p d·ªØ li·ªáu
            const patientId = document.getElementById('patient-id').value || 'Ch∆∞a nh·∫≠p';
            const diagnosis = document.getElementById('diagnosis').value || 'Ch∆∞a nh·∫≠p';
            const apgar1 = document.getElementById('apgar-1').value || '';
            const apgar2 = document.getElementById('apgar-2').value || '';
            const phLevel = document.getElementById('ph-level').value || 'Ch∆∞a ch·ªçn';
            const ctgDescription = document.getElementById('ctg-description').value || 'Ch∆∞a c√≥ m√¥ t·∫£';
            
            const acogResult = document.getElementById('acog-classification').value || 'Ch∆∞a ph√¢n t√≠ch';
            const figoResult = document.getElementById('figo-classification').value || 'Ch∆∞a ph√¢n t√≠ch';
            const japanResult = document.getElementById('japan-classification').value || 'Ch∆∞a ph√¢n t√≠ch';
            const niceResult = document.getElementById('nice-classification').value || 'Ch∆∞a ph√¢n t√≠ch';
            const physioResult = document.getElementById('physio-classification').value || 'Ch∆∞a ph√¢n t√≠ch';

            // T·∫°o HTML content v·ªõi ti·∫øng Vi·ªát
            pdfContent.innerHTML = `
                <div style="text-align: center; margin-bottom: 30px;">
                    <h1 style="color: #2c5aa0; margin-bottom: 10px; font-size: 24px;">
                        B√ÅO C√ÅO PH√ÇN T√çCH CTG
                    </h1>
                    <p style="font-size: 16px; color: #666;">
                        Ng√†y ph√¢n t√≠ch: ${new Date().toLocaleDateString('vi-VN', {
                            weekday: 'long',
                            year: 'numeric',
                            month: 'long',
                            day: 'numeric'
                        })}
                    </p>
                </div>

                <div style="margin-bottom: 25px;">
                    <h2 style="color: #2c5aa0; border-bottom: 2px solid #2c5aa0; padding-bottom: 5px;">
                        I. TH√îNG TIN B·ªÜNH NH√ÇN
                    </h2>
                    <table style="width: 100%; margin-top: 15px; border-collapse: collapse;">
                        <tr>
                            <td style="padding: 8px; font-weight: bold; width: 30%;">ID b·ªánh nh√¢n:</td>
                            <td style="padding: 8px; border-bottom: 1px dotted #ccc;">${patientId}</td>
                        </tr>
                        <tr>
                            <td style="padding: 8px; font-weight: bold; vertical-align: top;">Ch·∫©n ƒëo√°n:</td>
                            <td style="padding: 8px; border-bottom: 1px dotted #ccc;">${diagnosis}</td>
                        </tr>
                        ${(apgar1 || apgar2) ? `
                        <tr>
                            <td style="padding: 8px; font-weight: bold;">APGAR:</td>
                            <td style="padding: 8px; border-bottom: 1px dotted #ccc;">${apgar1}/${apgar2}</td>
                        </tr>
                        ` : ''}
                        <tr>
                            <td style="padding: 8px; font-weight: bold;">pH cu·ªëng r·ªën:</td>
                            <td style="padding: 8px; border-bottom: 1px dotted #ccc;">${phLevel}</td>
                        </tr>
                    </table>
                </div>

                <div style="margin-bottom: 25px;">
                    <h2 style="color: #2c5aa0; border-bottom: 2px solid #2c5aa0; padding-bottom: 5px;">
                        II. H√åNH ·∫¢NH CTG
                    </h2>
                    <div style="margin-top: 15px;">
                        ${getImageHTML('preview-before', '·∫¢nh CTG tr∆∞·ªõc ƒë√≥')}
                        ${getImageHTML('preview-current', '·∫¢nh CTG hi·ªán t·∫°i')}
                    </div>
                </div>

                <div style="margin-bottom: 25px;">
                    <h2 style="color: #2c5aa0; border-bottom: 2px solid #2c5aa0; padding-bottom: 5px;">
                        III. M√î T·∫¢ CTG
                    </h2>
                    <div style="margin-top: 15px; padding: 15px; background: #f8f9fa; border-left: 4px solid #2c5aa0; border-radius: 4px;">
                        ${ctgDescription}
                    </div>
                </div>

                <div style="margin-bottom: 25px;">
                    <h2 style="color: #2c5aa0; border-bottom: 2px solid #2c5aa0; padding-bottom: 5px;">
                        IV. K·∫æT QU·∫¢ PH√ÇN LO·∫†I
                    </h2>
                    
                    <div style="margin-top: 20px;">
                        <table style="width: 100%; border-collapse: collapse; margin-bottom: 20px;">
                            <thead>
                                <tr style="background: #2c5aa0; color: white;">
                                    <th style="padding: 12px; text-align: left; border: 1px solid #ddd;">H·ªá th·ªëng ph√¢n lo·∫°i</th>
                                    <th style="padding: 12px; text-align: left; border: 1px solid #ddd;">K·∫øt qu·∫£</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid #ddd; font-weight: bold;">ACOG 2009</td>
                                    <td style="padding: 10px; border: 1px solid #ddd;">${acogResult}</td>
                                </tr>
                                <tr style="background: #f8f9fa;">
                                    <td style="padding: 10px; border: 1px solid #ddd; font-weight: bold;">FIGO 2015</td>
                                    <td style="padding: 10px; border: 1px solid #ddd;">${figoResult}</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid #ddd; font-weight: bold;">Hi·ªáp h·ªôi S·∫£n ph·ª• khoa Nh·∫≠t B·∫£n</td>
                                    <td style="padding: 10px; border: 1px solid #ddd;">${japanResult}</td>
                                </tr>
                                <tr style="background: #f8f9fa;">
                                    <td style="padding: 10px; border: 1px solid #ddd; font-weight: bold;">NICE 2022</td>
                                    <td style="padding: 10px; border: 1px solid #ddd;">${niceResult}</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid #ddd; font-weight: bold;">Ph√¢n lo·∫°i Sinh l√Ω</td>
                                    <td style="padding: 10px; border: 1px solid #ddd;">${physioResult}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div style="margin-top: 40px; text-align: center; color: #666; font-style: italic; border-top: 1px solid #ddd; padding-top: 15px;">
                    <p>B√°o c√°o ƒë∆∞·ª£c t·∫°o t·ª± ƒë·ªông t·ª´ H·ªá th·ªëng Ph√¢n t√≠ch CTG</p>
                    <p>Th·ªùi gian t·∫°o: ${new Date().toLocaleString('vi-VN')}</p>
                </div>
            `;

            document.body.appendChild(pdfContent);

            // S·ª≠ d·ª•ng html2canvas ƒë·ªÉ chuy·ªÉn HTML th√†nh PDF
            html2canvas(pdfContent, {
                scale: 1.5,
                useCORS: true,
                allowTaint: true,
                backgroundColor: '#ffffff',
                width: pdfContent.scrollWidth,
                height: pdfContent.scrollHeight,
                scrollX: 0,
                scrollY: 0,
                windowWidth: pdfContent.scrollWidth,
                windowHeight: pdfContent.scrollHeight
            }).then(canvas => {
                const { jsPDF } = window.jspdf;
                
                const imgData = canvas.toDataURL('image/jpeg', 1.0);
                const pdf = new jsPDF({
                    orientation: 'portrait',
                    unit: 'mm',
                    format: 'a4'
                });

                const pageWidth = pdf.internal.pageSize.getWidth();
                const pageHeight = pdf.internal.pageSize.getHeight();
                
                const imgWidth = pageWidth;
                const imgHeight = (canvas.height * imgWidth) / canvas.width;

                let heightLeft = imgHeight;
                let position = 0;

                // Th√™m trang ƒë·∫ßu ti√™n
                pdf.addImage(imgData, 'JPEG', 0, position, imgWidth, imgHeight);
                heightLeft -= pageHeight;

                // Th√™m c√°c trang ti·∫øp theo n·∫øu c·∫ßn
                while (heightLeft >= 0) {
                    position = heightLeft - imgHeight;
                    pdf.addPage();
                    pdf.addImage(imgData, 'JPEG', 0, position, imgWidth, imgHeight);
                    heightLeft -= pageHeight;
                }

                // L∆∞u file
                const fileName = `CTG_Analysis_${patientId}_${new Date().toISOString().split('T')[0]}.pdf`;
                pdf.save(fileName);
                
                // Cleanup
                document.body.removeChild(pdfContent);
                
                showNotification('üìÑ ƒê√£ xu·∫•t file PDF th√†nh c√¥ng!', 'success');
            }).catch(error => {
                console.error('L·ªói khi t·∫°o PDF:', error);
                document.body.removeChild(pdfContent);
                showNotification('‚ùå L·ªói khi xu·∫•t PDF: ' + error.message, 'error');
            });
        }

        // H√†m helper ƒë·ªÉ t·∫°o HTML cho ·∫£nh
        function getImageHTML(previewId, title) {
            const preview = document.getElementById(previewId);
            const img = preview.querySelector('img');
            
            if (img && img.src && img.src !== '') {
                return `
                    <div style="margin-bottom: 20px; text-align: center;">
                        <h4 style="color: #2c5aa0; margin-bottom: 10px; font-size: 16px;">${title}</h4>
                        <div style="border: 2px solid #ddd; padding: 10px; display: inline-block; border-radius: 8px; background: #f9f9f9;">
                            <img src="${img.src}" style="max-width: 100%; max-height: 300px; border-radius: 4px;" alt="${title}">
                        </div>
                    </div>
                `;
            } else {
                return `
                    <div style="margin-bottom: 20px; text-align: center;">
                        <h4 style="color: #2c5aa0; margin-bottom: 10px; font-size: 16px;">${title}</h4>
                        <div style="border: 2px dashed #ccc; padding: 30px; color: #666; font-style: italic; border-radius: 8px; background: #f9f9f9;">
                            Kh√¥ng c√≥ ·∫£nh
                        </div>
                    </div>
                `;
            }
        }

        function reassess() {
            if (confirm('üîÑ B·∫°n c√≥ ch·∫Øc mu·ªën ƒë√°nh gi√° l·∫°i? T·∫•t c·∫£ d·ªØ li·ªáu hi·ªán t·∫°i s·∫Ω b·ªã x√≥a.')) {
                document.querySelectorAll('input, select, textarea').forEach(element => {
                    if (element.type === 'checkbox') {
                        element.checked = false;
                    } else {
                        element.value = '';
                    }
                });
                
                document.querySelectorAll('.image-preview').forEach(preview => {
                    preview.innerHTML = '';
                });
                
                document.querySelectorAll('.conditional-section').forEach(section => {
                    section.classList.add('hidden');
                });
                
                // ·∫®n k·∫øt qu·∫£ ph√¢n t√≠ch
                document.getElementById('analysis-results').classList.add('hidden');
                
                updateSummary();
            }
        }

        // Th√™m event listeners cho c√°c tr∆∞·ªùng ƒë·ªÉ t·ª± ƒë·ªông c·∫≠p nh·∫≠t t√≥m t·∫Øt
        document.addEventListener('change', updateSummary);
        document.addEventListener('input', updateSummary);
    </script>
</body>
</html>
